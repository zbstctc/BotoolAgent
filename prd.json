{
  "project": "PRD 生成系统增强",
  "branchName": "botool/prd-enhancements",
  "description": "借鉴 ECC 获奖项目，对 pyramidprd 和 generateprd 两个 Skill 增加代码库感知扫描、确认门控、风险评估和测试策略章节。pyramidprd 服务 Viewer 用户，generateprd 服务 CLI 开发者。",
  "devTasks": [
    {
      "id": "DT-001",
      "title": "pyramidprd SKILL.md — 增加代码库感知扫描指令",
      "description": "在 pyramidprd SKILL.md 中，L1 完成后、L2 开始前，新增代码库扫描阶段。指导 Claude 使用 Glob/Grep/Read 扫描项目，识别技术栈、架构模式、现有组件、业务模型和 API 接口。扫描结果内化为更精准的 L2/L3 问题。无代码库时跳过。在 metadata 中标记 codebaseScanned。",
      "acceptanceCriteria": [
        "SKILL.md 中有明确的代码库扫描阶段指令（在 L1→L2 之间）",
        "扫描指令覆盖：技术栈检测、目录结构分析、现有组件/路由/API 识别、数据模型分析",
        "有「无代码库」场景的降级处理（跳过扫描）",
        "扫描结果体现在 L2/L3 问题的选项中（如现有技术栈作为预设选项）",
        "metadata 中标记 codebaseScanned: true/false",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "修改文件：~/.claude/skills/botoolagent-pyramidprd/SKILL.md"
    },
    {
      "id": "DT-002",
      "title": "pyramidprd SKILL.md — 增加确认门控流程",
      "description": "在 pyramidprd SKILL.md 中，L4 完成后、PRD 生成前，新增确认门控阶段。通过 AskUserQuestion 输出结构化确认摘要（需求摘要、功能范围、风险评估、复杂度估计），metadata 标记 phase: 'confirmation' 和 level: 5。用户可选确认并生成或返回修改。",
      "acceptanceCriteria": [
        "SKILL.md 中 L4 之后有明确的确认门控指令",
        "确认摘要通过 AskUserQuestion 输出，包含需求摘要、功能范围、风险评估",
        "metadata 包含 phase: 'confirmation' 和 level: 5",
        "用户可选择确认并生成或返回修改",
        "返回修改时 Claude 能重新提问",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "修改文件：~/.claude/skills/botoolagent-pyramidprd/SKILL.md"
    },
    {
      "id": "DT-003",
      "title": "pyramidprd SKILL.md — 更新 PRD 模板增加风险和测试章节",
      "description": "修改 pyramidprd SKILL.md 的 PRD 输出模板，在 Dev Tasks 之后新增 Risks & Mitigations 章节（HIGH/MEDIUM/LOW 分级）和 Testing Strategy 章节（单元/集成/E2E）。指导 Claude 基于 L1-L4 答案自动生成。",
      "acceptanceCriteria": [
        "SKILL.md PRD 模板包含 Risks & Mitigations 章节",
        "SKILL.md PRD 模板包含 Testing Strategy 章节",
        "章节位于 Dev Tasks 之后、Non-Goals 之前",
        "风险分 HIGH/MEDIUM/LOW 三级",
        "测试策略覆盖单元/集成/E2E 三种类型",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "修改文件：~/.claude/skills/botoolagent-pyramidprd/SKILL.md"
    },
    {
      "id": "DT-004",
      "title": "generateprd SKILL.md — 重构定位 + 增加代码库扫描",
      "description": "重构 generateprd SKILL.md 为纯 CLI 开发者工具。删除所有 Viewer 相关指令（Viewer Mode、Do NOT use tools 限制等）。Phase 1 增加结构化代码库扫描，使用 Glob/Grep/Read 分析项目技术栈、架构、业务逻辑。新项目时跳过。",
      "acceptanceCriteria": [
        "SKILL.md 中不包含任何 Viewer 相关指令",
        "Phase 1 有明确的代码库扫描步骤",
        "扫描使用 Glob/Grep/Read 工具，覆盖技术栈+架构+业务逻辑",
        "扫描结果体现在后续问题的选项和上下文中",
        "无代码库场景有降级处理",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "修改文件：~/.claude/skills/botoolagent-generateprd/SKILL.md。删除 Viewer Mode 和 IMPORTANT: You are running inside BotoolAgent Viewer 章节。"
    },
    {
      "id": "DT-005",
      "title": "generateprd SKILL.md — 增加确认门控 + 更新 PRD 模板",
      "description": "在 generateprd SKILL.md 的 Phase 3 和 Phase 4 之间插入 Final Confirmation 步骤，通过 AskUserQuestion 展示确认摘要。同时更新 PRD 模板增加 Risks & Mitigations 和 Testing Strategy 章节。更新 Checklist。",
      "acceptanceCriteria": [
        "Phase 3 和 Phase 4 之间有明确的确认门控步骤",
        "确认摘要通过 AskUserQuestion 展示",
        "用户可选择确认生成或返回修改",
        "PRD 模板包含 Risks & Mitigations 章节",
        "PRD 模板包含 Testing Strategy 章节",
        "Checklist 已更新",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "修改文件：~/.claude/skills/botoolagent-generateprd/SKILL.md"
    },
    {
      "id": "DT-006",
      "title": "更新 tool-types.ts 和 PyramidNavigation 支持新状态",
      "description": "更新 tool-types.ts 中 PyramidMetadata 增加 phase、codebaseScanned、codebaseSummary 字段。修改 PyramidNavigation 组件支持 5 层显示（L1-L4 + 确认）。stage1/page.tsx 中 levels 数组从 4 层扩展到 5 层。codebaseScanned 时 L2 层显示已分析提示。",
      "acceptanceCriteria": [
        "PyramidMetadata 类型增加 phase、codebaseScanned、codebaseSummary 可选字段",
        "PyramidNavigation 支持第 5 层确认显示",
        "代码库扫描状态在 UI 中有体现",
        "卡片/对话框背景为白色",
        "Typecheck passes",
        "Verify in browser"
      ],
      "priority": 6,
      "passes": false,
      "notes": "修改文件：viewer/src/lib/tool-types.ts、viewer/src/components/PyramidNavigation.tsx、viewer/src/app/stage1/page.tsx"
    },
    {
      "id": "DT-007",
      "title": "Viewer — 确认门控 UI 组件",
      "description": "修改 Stage 1 页面，识别 phase: 'confirmation' 的 metadata，渲染为摘要卡片 UI（区别于普通问答界面）。卡片展示需求摘要、功能列表、风险评估等分区，底部有确认并生成 PRD 和返回修改按钮。",
      "acceptanceCriteria": [
        "Stage 1 页面识别 confirmation 阶段并渲染卡片 UI",
        "卡片包含需求摘要、功能范围、风险评估等分区",
        "确认并生成和返回修改按钮功能正常",
        "左侧导航显示确认层级状态",
        "卡片背景为白色（遵循项目规范）",
        "Typecheck passes",
        "Verify in browser"
      ],
      "priority": 7,
      "passes": false,
      "notes": "修改文件：viewer/src/app/stage1/page.tsx。依赖 DT-006 的类型定义。"
    }
  ]
}
