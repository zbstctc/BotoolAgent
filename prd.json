{
  "project": "金字塔问答 CLI Skill 集成",
  "branchName": "botool/pyramid-cli-skill",
  "description": "将金字塔问答流程改为 CLI Skill 控制模式，Skill 控制问答流程，前端只负责渲染",
  "devTasks": [
    {
      "id": "DT-001",
      "title": "改造 Skill 为可触发模式",
      "description": "修改 ~/.claude/skills/botoolagent-pyramidprd/SKILL.md，改为 user-invocable，重写问答流程逻辑，使用 AskUserQuestion 工具按 L1-L4 层级提问",
      "acceptanceCriteria": [
        "user-invocable: true",
        "Skill 定义完整的 L1-L4 问答流程",
        "使用 AskUserQuestion 工具提问",
        "每个问题带 metadata: { level, progress, dimension }",
        "根据答案动态调整后续问题",
        "L4 完成后生成 PRD 文档",
        "Skill 文件语法正确，可被 CLI 加载"
      ],
      "priority": 1,
      "passes": true,
      "notes": "SKILL.md 已完成"
    },
    {
      "id": "DT-002",
      "title": "验证 AskUserQuestion metadata 支持",
      "description": "确认 AskUserQuestion 工具的 metadata 字段可以传递 level 等信息，前端能正确接收",
      "acceptanceCriteria": [
        "确认 AskUserQuestion 支持 metadata 字段",
        "测试 CLI 发送带 metadata 的 tool_use",
        "前端能从 SSE 事件中解析 metadata",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "DT-003",
      "title": "创建 Stage 1 CLI 聊天模式页面",
      "description": "重写 /stage1/page.tsx，改为 CLI 聊天模式，监听 tool_use 事件渲染问题",
      "acceptanceCriteria": [
        "使用 useCliChat hook 连接 CLI",
        "初始发送 /botoolagent-pyramidprd {description} 触发 Skill",
        "监听 tool_use 事件，识别 AskUserQuestion",
        "渲染问题 UI（复用现有组件或新建）",
        "从 metadata.level 更新金字塔进度条",
        "用户回答后调用 respondToTool 发送答案",
        "收到 PRD 文本后显示在预览区",
        "Typecheck passes",
        "Verify in browser"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Stage 1 页面已重写为 CLI 聊天模式，L1->L2 流程验证通过"
    },
    {
      "id": "DT-004",
      "title": "金字塔进度条组件适配",
      "description": "修改 PyramidNavigation 组件，支持从 CLI 事件更新进度，改为只读展示模式",
      "acceptanceCriteria": [
        "接收 currentLevel prop 从 CLI 事件更新",
        "显示当前层级和已完成层级",
        "不再控制层级切换（只读展示）",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "组件已满足要求，Stage 1 页面中 onLevelClick 设为空函数"
    },
    {
      "id": "DT-005",
      "title": "问题渲染组件适配",
      "description": "确保问题渲染组件能处理 AskUserQuestion 返回的问题格式",
      "acceptanceCriteria": [
        "支持 single/multi/text 问题类型",
        "支持 options 选项渲染",
        "支持批量问题（questions 数组）",
        "收集答案并返回给父组件",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "已在 DT-003 中实现，直接在 Stage 1 页面内渲染问题"
    },
    {
      "id": "DT-006",
      "title": "清理旧的 API 和逻辑",
      "description": "移除不再需要的旧代码，包括 /api/pyramid/questions 和相关调用",
      "acceptanceCriteria": [
        "移除或标记废弃 /api/pyramid/questions",
        "移除 skill-parser.ts 的调用（Skill 内部处理）",
        "移除旧的 generateQuestions 函数",
        "清理无用的 state 和 effects",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "已标记所有 pyramid API 为废弃，Stage 1 页面中的旧逻辑已在 DT-003 中移除"
    },
    {
      "id": "DT-007",
      "title": "全流程测试",
      "description": "测试完整的金字塔问答流程，确保 L1-L4 正常工作",
      "acceptanceCriteria": [
        "输入需求描述，触发 Skill",
        "L1 问题正确显示，进度条显示 L1",
        "回答 L1 后进入 L2，进度条更新",
        "L2-L4 流程正常",
        "L4 完成后 PRD 正确生成",
        "PRD 可以保存",
        "Verify in browser"
      ],
      "priority": 7,
      "passes": true,
      "notes": "L1-L4 全流程测试通过，PRD 成功生成并保存"
    },
    {
      "id": "DT-008",
      "title": "Playwright 自动化测试",
      "description": "运行 Playwright 测试验证 Stage 1 功能",
      "acceptanceCriteria": [
        "Playwright 测试 Stage 1 页面通过"
      ],
      "priority": 8,
      "passes": true,
      "notes": "使用 MCP Playwright 工具完成浏览器验证测试"
    }
  ]
}
