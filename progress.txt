# Botool 开发代理进度日志
开始时间: Thu Feb 19 02:06:26 CST 2026
---
## 2026-02-19 - DT-001
- 实现了 ProgressStrip 组件（增强进度带）
- 新增文件: viewer/src/components/ProgressStrip.tsx
- 三种状态切换：未运行/运行中/完成，含 ETA 和均速计算
- **未来迭代的经验教训：**
  - formatTime 工具函数可复用于 BatchPanel 计时器
  - agentStartTimestamp 需从 AgentStatus 转换为 Unix ms
---
## 2026-02-19 - DT-002
- 实现了 useTeammates Hook + 数据基础设施
- 新增文件: viewer/src/hooks/useTeammates.ts
- 修改文件: hooks/index.ts, useFileWatcher.ts, api/watch/route.ts, lib/project-root.ts
- teammates.json SSE 监听 + 拓扑排序 fallback + 过期检测
- **未来迭代的经验教训：**
  - DevTask 接口无 dependsOn 字段，useTeammates 内用 DevTaskWithDeps 扩展
  - 拓扑排序 BFS 层级遍历模式可被 BatchTimeline 复用
  - useFileWatcher 返回的 teammates 字段需在 stage3/page.tsx 中消费
---
## 2026-02-19 - DT-003
- 实现了 useTaskTimings Hook（任务耗时推算）
- 新增文件: viewer/src/hooks/useTaskTimings.ts
- 修改文件: hooks/index.ts (+2 lines export)
- 多数据源融合：teammates.json 优先 → progressLog 次选 → 均分 fallback
- 按批次分组二维数组 batches: TaskTiming[][]
- 每秒 tick 更新 currentTaskElapsed
- **未来迭代的经验教训：**
  - batchMap 只包含当前批次的任务，历史批次任务默认 batchIndex=0
  - DT-008 集成时需将 useTaskTimings 结果传给 BatchPanel 和 BatchTimeline
---
## 2026-02-19 - DT-006
- 实现了 LiveLog 组件 + AgentDataPanel 统计区增强
- 新增文件: viewer/src/components/LiveLog.tsx
- 修改文件: AgentDataPanel/AgentDataPanel.tsx (+GitStats 接口, +统计区段, +formatDuration/formatEta)
- LiveLog: bg-neutral-900 深色背景、font-mono、120px 固定高度、自动滚动
- AgentDataPanel 新增 props: elapsedSeconds, gitStats, avgTaskTime, eta
- **未来迭代的经验教训：**
  - LiveLog 和 AgentDataPanel 的新 props 需在 DT-008 页面集成时从 hooks 传入
  - GitStats 接口已从 AgentDataPanel 导出，可被 stage3/page.tsx 导入
---
## 2026-02-19 - DT-007
- 实现了 Tab 重排序 + 流程图降级
- 修改文件: viewer/src/app/stage3/page.tsx
- Tab 新顺序：文件变更 | 提交记录 | 流程图ℹ️
- 默认激活 tab 改为 'changes'
- 移除进度日志 tab + logEndRef + useRef import
- **未来迭代的经验教训：**
  - progressLog state 仍保留（用于 iterationCount 提取）
  - DT-008 集成时需在中间区域添加 ProgressStrip / BatchPanel / BatchTimeline
---
## 2026-02-19 - DT-004
- 实现了 BatchPanel 组件（Agent Teams 可视化批次面板）
- 新增文件: viewer/src/components/BatchPanel.tsx
- 并行模式（卡片网格 grid-cols-2/3/4）+ 串行模式（详情卡片含验收标准）
- 计时器颜色阈值：正常/黄(>2x均值)/红(>3x均值)
- 空状态 + 完成状态 + 运行中呼吸动画
- **未来迭代的经验教训：**
  - BatchPanel 需在 DT-008 集成时从 page.tsx 传入 teammates + timings props
  - formatTime 辅助函数与 ProgressStrip 重复，可考虑未来提取到公共 utils
  - Unicode escapes 用于中文字符串（编码无差别，但影响可读性）
---
## 2026-02-19 - DT-005
- 验收确认 BatchTimeline 组件（已在前一 session 提交 f698d0a）
- 文件: viewer/src/components/BatchTimeline.tsx
- 拓扑排序批次分组、B{n} 标签、条形宽度比例、颜色编码、自动滚动
- **未来迭代的经验教训：**
  - BatchTimeline 需在 DT-008 中接收 batches/maxDuration/currentBatchIndex props
  - getTaskStatus 逻辑：passes=false + endTime → failed（可能需要更精确的失败判断）
---
