# PRD: BotoolAgent PRD ç®¡çº¿å…¨é“¾è·¯å‡çº§

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 èƒŒæ™¯ä¸åŠ¨æœº

BotoolAgent çš„ PRD ç®¡çº¿ï¼ˆPyramidPRD â†’ PRD2JSON â†’ PRDReviewï¼‰åœ¨å¤„ç†å¤§å‹é¡¹ç›®ï¼ˆbotool-present-v16, 8120 è¡Œ PRDï¼‰æ—¶æš´éœ²äº†å››ä¸ªç»´åº¦çš„ç»“æ„æ€§é—®é¢˜ï¼š

**è¾“å‡ºæ ¼å¼é—®é¢˜**ï¼š

| # | é—®é¢˜ | æ ¹å›  | å½±å“ |
|---|------|------|------|
| 1 | T7 å‡é˜³æ€§ | T7 åªæ£€æŸ¥ CREATE TABLE æ•°é‡å’Œæ€»è¡Œæ•° | 13 å­—æ®µçš„è¡¨åªç”Ÿæˆ 6 å­—æ®µä»æŠ¥ âœ… |
| 2 | UUID æ¼‚ç§» | AI æ“…è‡ªæ”¹ PK ç±»å‹ | ä¸æºè¡¨ FK é“¾æ–­è£‚ |
| 3 | å­—æ®µä¸¢å¤± | T7 æ— å­—æ®µçº§æ ¡éªŒ | ä¸¤å¼ è¡¨å…±ç¼º 16 ä¸ªå­—æ®µ |
| 4 | è§„åˆ™ä¸¢å¤± | 1165 è¡Œè§„åˆ™åªç”Ÿæˆ 70 è¡Œ | è¦†ç›–ç‡ 6% |
| 5 | skip-read è„†å¼± | prdSection è¡Œå·åœ¨ prd.md è¢«ç¼–è¾‘åæ¼‚ç§» | Lead Agent è·³è¯»å¤±è´¥ |
| 6 | èŒè´£é‡å  | PyramidPRD å’Œ PRD2JSON éƒ½å†™ prd.json | å‰è€…ç™½å†™ï¼Œåè€…è¦†ç›– |
| 7 | ä¸¤æ­¥æ‰‹åŠ¨æ“ä½œ | PyramidPRD â†’ æ‰‹åŠ¨ /prd2json | ç”¨æˆ·å¿˜è®°è·‘ç¬¬äºŒæ­¥ |

**ç®¡çº¿ä¸»æƒé—®é¢˜**ï¼šä¸‰ä¸ª Skill éƒ½å¯ä¿®æ”¹ prd.mdï¼Œå¯¼è‡´æ–‡ä»¶çŠ¶æ€ä¸å¯é¢„æµ‹ã€‚ä¸‰æ–¹ä¿®æ”¹è¿é”ååº”ï¼š
```
PyramidPRD ç”Ÿæˆ prd.md (v1)
  â†“
PRDReview ä¿®å¤ â†’ prd.md (v2)  â† è¡Œå·å˜äº†
  â†“
PRD2JSON æ³¨å…¥ [è¦ç¯„] â†’ prd.md (v3)  â† è¡Œå·åˆå˜äº†
  â†“
PRD2JSON æ‰«æè¡Œå·ç”Ÿæˆ prdSection  â† åŸºäº v3
```

**æ‰§è¡Œå¼•æ“é—®é¢˜**ï¼šå®Œæ•´è§„åˆ’ ~150KBã€Transform ~200KB+ çš„ä¸Šä¸‹æ–‡æ¶ˆè€—å¯¼è‡´ compact ä¸¢å¤±é—®ç­”å†å²ï¼Œ8120 è¡Œ PRD æ‰‹åŠ¨æ‹†åˆ†å¯¼è‡´ Schema å­¤å²›å’Œäº¤å‰å¼•ç”¨æ–­è£‚ã€‚

**é—®ç­”æ•ˆç‡é—®é¢˜**ï¼š5 å±‚ Ã— 3-12 é¢˜ = æœ€å¤š 23-44 æ¬¡äº¤äº’ï¼Œ30-45 åˆ†é’Ÿå®Œæˆå®Œæ•´è§„åˆ’ã€‚80% çš„æƒ…å†µä¸‹ç”¨æˆ·ç›´æ¥æ¥å— AI æ¨èï¼Œé€é¢˜é—®ç­”æ˜¯ä¸å¿…è¦çš„è´Ÿæ‹…ã€‚

### 1.2 æ ¸å¿ƒç›®æ ‡

**ä¸€å¥è¯å®šä½**: å°† BotoolAgent çš„ PRD ç®¡çº¿ä»"å¤šæ–¹å†™å…¥ + è„†å¼±è·³è¯» + å•å¯¹è¯è†¨èƒ€ + é€é¢˜æ…¢é—®"å‡çº§ä¸º"å•ä¸€å†™å…¥æ–¹ + è‡ªç»™è‡ªè¶³ + æŒä¹…åŒ– + æ–¹æ¡ˆå¡å¿«é—®"çš„åŒäº§ç‰©ç®¡çº¿ã€‚

**å››ä¸ªç»´åº¦**:
1. **è¾“å‡ºæ ¼å¼å‡çº§** â€” prd.md + fat dev.json ä¸¤ä»¶å¥—ï¼Œæ¶ˆé™¤ skip-read è„†å¼±æ€§
2. **ç®¡çº¿ä¸»æƒé‡æ„** â€” prd.md å†™å…¥æƒé™åˆ†çº§ï¼ˆPyramidPRD ä¸»å†™ + PRDReview å—æ§å†™ï¼‰ï¼ŒPRD2JSON åªè¯»åŒ–
3. **æ‰§è¡Œå¼•æ“å‡çº§** â€” Q&A Journal + Subagent ç®¡çº¿ï¼Œæ¶ˆé™¤ä¸Šä¸‹æ–‡çˆ†ç‚¸ï¼ˆ~150KB â†’ ~50KBï¼‰
4. **é—®ç­”åŠ é€Ÿ** â€” æ–¹æ¡ˆå¡æ‰¹é‡ç¡®è®¤ï¼Œäº¤äº’æ¬¡æ•°ä» 23-44 æ¬¡é™è‡³ ~9 æ¬¡

**ä¸‰å¤§æ¨¡å¼**ï¼ˆv1 å››æ¨¡å¼ â†’ v2 ä¸‰æ¨¡å¼ï¼Œåˆ é™¤å¿«é€Ÿä¿®å¤ï¼‰:
- å®Œæ•´è§„åˆ’ â€” å…¨é‡ 6 å±‚é—®ç­” + æ–¹æ¡ˆå¡
- åŠŸèƒ½å¼€å‘ â€” ç²¾ç®€é—®ç­”ï¼ˆL1+L4 æ–¹æ¡ˆå¡ï¼‰
- å¯¼å…¥æ¨¡å¼ï¼ˆTransformï¼‰ â€” å¤–éƒ¨ PRD è½¬æ¢

**è‡ªåŠ¨åŒ–ç®¡çº¿** â€” ç”¨æˆ·ç¡®è®¤ PRD åå…¨è‡ªåŠ¨: PyramidPRD â†’ A1 PRDReview(è‡ªåŠ¨å®¡æŸ¥) â†’ A2 PRD2JSON(è‡ªåŠ¨è½¬æ¢)

### 1.3 æˆåŠŸæŒ‡æ ‡

- CREATE TABLE å­—æ®µå®Œæ•´ç‡ â‰¥ 95%ï¼ˆå½“å‰ ~54%ï¼‰
- ä¸šåŠ¡è§„åˆ™è¦†ç›–ç‡ â‰¥ 40%ï¼ˆå½“å‰ 6%ï¼‰
- Lead Agent ä¸å† skip-read prd.md Â§7
- å®Œæ•´è§„åˆ’äº¤äº’ â‰¤ 10 æ¬¡ï¼ˆå½“å‰ 23-44 æ¬¡ï¼‰
- ä¸»å¯¹è¯ä¸Šä¸‹æ–‡ â‰¤ 50KBï¼ˆå½“å‰ ~150KBï¼‰
- Ralph è‡ªåŠ¨ç®¡çº¿ç«¯åˆ°ç«¯é€šè¿‡
- 18 é¡¹ Checklist å…¨é€šè¿‡

## 2. å½“å‰çŠ¶æ€

### 2.1 å·²æœ‰èƒ½åŠ›

**Producer Chainï¼ˆä¸‰ä¸ª Skillï¼‰**:
```
PyramidPRD (SKILL.md 1883 è¡Œ)
  â”œâ”€ WRITE: prd.md (Â§1-Â§8)
  â”œâ”€ WRITE: prd.json (slim)        â† ä¸ PRD2JSON å†²çªï¼Œç™½å†™è¢«è¦†ç›–
  â”œâ”€ WRITE: registry.json          â† ä¸ PRD2JSON å†²çª
  â”œâ”€ WRITE: PROJECT.md             â† ä»£ç åº“æ‰«æå…ƒæ•°æ®
  â””â”€ å‘ŠçŸ¥ç”¨æˆ·: "è¯·æ‰‹åŠ¨è¿è¡Œ /prd2json"

PRDReview (SKILL.md + Viewer API)
  â”œâ”€ READ: prd.md                  â† PRD å®¡æŸ¥æ¨¡å¼ (5 ç»´åº¦)
  â”œâ”€ READ: prd.json                â† Enrich å®¡æŸ¥æ¨¡å¼ (5 ç»´åº¦)
  â”œâ”€ è°ƒç”¨ Codex: exec --full-auto  â† æ•Œå¯¹å®¡æŸ¥å¼•æ“
  â”œâ”€ æ•Œå¯¹å¾ªç¯: max 3 è½® (ä¿®å¤/é©³å›) â† Mode A + Mode B
  â”œâ”€ WRITE: prd-review.json        â† å®¡æŸ¥æŠ¥å‘Šï¼ˆé›¶è‡ªåŠ¨æ¶ˆè´¹æ–¹ï¼‰
  â”œâ”€ WRITE: prd-review-fixed.md    â† ä¿®å¤å»ºè®®æ–‡ä»¶
  â””â”€ MODIFY: prd.md (å¯é€‰)         â† é€šè¿‡ review-save API è¦†ç›– âš ï¸

PRD2JSON (SKILL.md 1006 è¡Œ)
  â”œâ”€ æ£€æµ‹ Viewer â†’ å¯é€‰å¯åŠ¨ dev server
  â”œâ”€ MODIFY: prd.md Â§7             â† æ³¨å…¥ [è¦ç¯„] æ¡ç›® âš ï¸
  â”œâ”€ é‡æ–°æ‰«æè¡Œå·                  â† å› ä¸ºä¿®æ”¹äº† prd.md
  â”œâ”€ WRITE: prd.json (slim, è¦†ç›–)  â† prdSection è¡Œå·æŒ‡é’ˆ
  â”œâ”€ WRITE: registry.json
  â”œâ”€ WRITE: progress.txt (é‡ç½®)
  â””â”€ WRITE: prd-completeness-report.md (Transform æ¨¡å¼)
```

**Consumer Chain**:
```
Lead Agent (CLAUDE.lead.md 346 è¡Œ)
  â”œâ”€ READ: prd.json
  â”‚   â”œâ”€ Slim æ¨¡å¼: prdFile + prdSection â†’ skip-read prd.md Â§7  â† è„†å¼±
  â”‚   â””â”€ Fat æ¨¡å¼: description + AC[] (backward compat)
  â”œâ”€ READ: prd.md (è¢« prdSection è·³è¯»)
  â”œâ”€ WRITE: prd.json (passes: true)
  â””â”€ WRITE: progress.txt (append)

Testing SKILL â†’ READ: prd.json (branchName, testCases, playwrightMcp)
Coding SKILL â†’ READ: prd.json (branchName) â†’ å¯åŠ¨ BotoolAgent.sh
Finalize SKILL â†’ READ: prd.json (branchName) + testing-report.json
BotoolAgent.sh (6 å¤„ç¡¬ç¼–ç  prd.json) â†’ READ: prd.json (branchName)
```

### 2.2 ç¼ºå£åˆ†æ

| # | ç¼ºé™· | å½±å“èŒƒå›´ |
|---|------|---------|
| 1 | **ä¸‰æ–¹ä¿®æ”¹ prd.md** | PyramidPRD + PRDReview + PRD2JSON éƒ½å†™ prd.md |
| 2 | **åŒæ–¹å†™ prd.json** | PyramidPRD + PRD2JSON éƒ½å†™ï¼ˆå‰è€…è¢«è¦†ç›–ï¼‰ |
| 3 | **prdSection è¡Œå·è„†å¼±** | ä»»ä½• prd.md ä¿®æ”¹éƒ½å¯¼è‡´è¡Œå·æ¼‚ç§» |
| 4 | **skip-read ä¾èµ–é“¾** | Lead Agent ç”¨è¡Œå·è·³è¯» â†’ å®šä½é”™è¯¯ â†’ ç”Ÿæˆé”™è¯¯ä»£ç  |
| 5 | **write-only åƒµå°¸å­—æ®µ** | constitutionFusedAt, knownGaps å†™äº†æ²¡äººè¯» |
| 6 | **æ‰‹åŠ¨ä¸¤æ­¥æ“ä½œ** | ç”¨æˆ·å¿˜è®° /prd2json |
| 7 | **ä¸Šä¸‹æ–‡çˆ†ç‚¸** | å•å¯¹è¯ 150-200KB |
| 8 | **PRDReview Enrich ç»´åº¦è¿‡æ—¶** | 5 ç»´åº¦é’ˆå¯¹ slim prd.jsonï¼Œç¼º fat dev.json æ ¡éªŒ |
| 9 | **é€é¢˜æ…¢é—®** | 23-44 æ¬¡äº¤äº’ï¼Œ~30 åˆ†é’Ÿå®Œæ•´è§„åˆ’ |

## 3. æ¶æ„è®¾è®¡

### 3.1 æ ¸å¿ƒæ¦‚å¿µ: æ–‡ä»¶ä¸»æƒ + ç®¡çº¿ç¼–æ’

```
   PyramidPRD (ä¸»å†™å…¥æ–¹)
      â”‚
      â”œâ”€â”€ WRITE â”€â”€â”€â”€ prd.md
      â”‚                â”‚
      â”‚                â”œâ”€â”€ è¢« PRDReview å—æ§è¦†ç›– (A1 æ¨¡å¼)
      â”‚                â””â”€â”€ è¢« PRD2JSON åªè¯»æ¶ˆè´¹
      â”‚
      â”œâ”€â”€ WRITE â”€â”€â”€â”€ qa-journal.md
      â”‚                â””â”€â”€ è¢« PRD2JSON è¯»å– R1 è§„èŒƒ
      â”‚
      â””â”€â”€ AUTO-CHAIN â†’ PRDing Ralph ç¼–æ’å™¨ (Background Agent)
                          â”‚
                          â”œâ”€ A1: PRDReview â†’ prd.md(reviewed)
                          â””â”€ A2: PRD2JSON â†’ dev.json (fat)
```

### 3.2 æ¶æ„å†³ç­–è®°å½• (ADR)

**ADR-1: ä¸¤ä»¶å¥— + Â§7 ä¸å‰¥ç¦»**
```
å†³ç­–: prd.md ä¿ç•™å®Œæ•´ Â§1-Â§8ï¼ˆå« Â§7ï¼‰ï¼Œdev.json ä¸ºèƒ–æ ¼å¼è‡ªç»™è‡ªè¶³
æ›¿ä»£æ–¹æ¡ˆ:
  A. ä¸¤ä»¶å¥— + Â§7 å‰¥ç¦» â€” è¢«å¦å†³ï¼ˆå¢åŠ å¤æ‚åº¦ï¼Œé›¶æ”¶ç›Šï¼‰
  B. ä¸‰ä»¶å¥— (prd.md + dev.md + dev.json) â€” è¢«å¦å†³ï¼ˆdev.md é›¶æ¶ˆè´¹æ–¹ï¼‰
  D. ä¸€ä»¶å¥— (prd.md å« JSON) â€” è¢«å¦å†³ï¼ˆæœºè¯»å›°éš¾ï¼‰
```

Â§7 åœ¨ prd.md ä¸­å˜æˆ**æƒ°æ€§å†…å®¹** â€” æ²¡æœ‰ Agent ä¸»åŠ¨ä¾èµ–å®ƒï¼Œä½†ä¿ç•™ä¸ºå®¹ç¾å¤‡ä»½ã€äººç±»å¯è¯»å’Œå®¡æŸ¥åŸºå‡†ã€‚

**ADR-2: ä¸ç”Ÿæˆ dev.md**
```
å†³ç­–: ä¸ç”Ÿæˆ dev.mdï¼ŒÂ§7 ä¿ç•™åœ¨ prd.md ä¸­
ç†ç”±: dev.md æ²¡æœ‰ç‹¬ç«‹æ¶ˆè´¹æ–¹ã€‚Lead Agent è¯» dev.jsonï¼Œä¸è¯» dev.mdã€‚é›¶æ¶ˆè´¹æ–¹ = çº¯å†—ä½™ã€‚
```

**ADR-3: PRDing Ralph æ¨¡å‹ï¼ˆBackground Agent ç¼–æ’å™¨ï¼‰**
```
å†³ç­–: PyramidPRD Tf å®Œæˆåå¯åŠ¨ Background Agent ç¼–æ’å™¨æ‰§è¡Œ A1+A2
ç®¡çº¿: PyramidPRD(ä¸»å¯¹è¯) â†’ Tf â†’ Task(run_in_background) â†’ [A1 â†’ A2]
æœºåˆ¶: Task å·¥å…· (run_in_background: true, subagent_type: general-purpose)
ç¼–æ’å™¨å†…éƒ¨:
  - A1: Skill("prdreview") projectId=<id>
  - A2: Skill("prd2json") mode=<mode> projectId=<id> prerequisites=<deps>
é™çº§: ç¼–æ’å™¨å¤±è´¥ â†’ é€šçŸ¥ç”¨æˆ·æ‰‹åŠ¨è¿è¡Œ /prdreview â†’ /prd2json
å·²éªŒè¯: Task subagent å¯è°ƒç”¨ Skill å·¥å…·ï¼ˆspike æµ‹è¯•é€šè¿‡ï¼‰
```

Context éš”ç¦»: ä¸»å¯¹è¯ ~50KB ç»“æŸï¼ŒA1+A2 åœ¨ç‹¬ç«‹ context ~245KB budget ä¸­æ‰§è¡Œã€‚A1 å®Œæˆåç³»ç»Ÿè‡ªåŠ¨å‹ç¼© A1 ä¼šè¯è½®æ¬¡ï¼ˆ~125KB â†’ ~10KB æ‘˜è¦ï¼‰ï¼ŒA2 ä»æ–‡ä»¶è¯»å–è¾“å…¥ã€‚

**A1â†’A2 æ–‡ä»¶äº¤æ¥ï¼ˆContext å®‰å…¨è®¾è®¡ï¼‰**:
- A1 PRDReview çš„å…¨éƒ¨äº§å‡ºå†™å…¥æ–‡ä»¶: prd.md(reviewed) + prd-review.json + prd-review-fixed.md
- A1 å®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å‹ç¼© A1 ä¼šè¯è½®æ¬¡ï¼ˆ~125KB â†’ ~10KB æ‘˜è¦ï¼‰
- A2 PRD2JSON ä»æ–‡ä»¶è¯»å–è¾“å…¥: prd.md(reviewed) + qa-journal.mdï¼Œä¸ä¾èµ– A1 çš„ in-context è¾“å‡º
- å®é™… A2 å¯ç”¨ context â‰ˆ 235KBï¼Œç»°ç»°æœ‰ä½™
- **ä¸éœ€è¦æ‰‹åŠ¨ /compact**ï¼ˆç³»ç»Ÿè‡ªåŠ¨å‹ç¼©åœ¨æ¥è¿‘ context limit æ—¶è§¦å‘ï¼‰

**è‡ªåŠ¨æ¨¡å¼è¡Œä¸ºè°ƒæ•´**:
- PRDReview Circuit Breaker: auto-chain ä¸­é»˜è®¤ accept + advisoryï¼ˆä¸é˜»å¡ç®¡çº¿ï¼‰
- PyramidPRD Tf å®Œæ•´æ€§æ¯”å¯¹: åœ¨ PRD ç”Ÿæˆåç«‹å³æ‰§è¡Œï¼ˆPRD2JSON ä¸å†åšæºæ–‡ä»¶æ¯”å¯¹ï¼‰
- ç¼–æ’å™¨å¤±è´¥æ—¶æ‰“å°æ˜ç¡®æ¢å¤æŒ‡ä»¤: `è¯·è¿è¡Œ /prdreview ç„¶å /prd2json`

**ADR-4: prd.md å†™å…¥æƒé™åˆ†çº§**
```
å†³ç­–:
  ä¸»å†™å…¥æ–¹: PyramidPRDï¼ˆç”Ÿæˆ prd.mdï¼‰
  å—æ§å†™å…¥æ–¹: PRDReviewï¼ˆå®¡æŸ¥ä¿®å¤åå¯è¦†ç›– prd.mdï¼Œä¿ç•™ v1 UXï¼‰
  åªè¯»æ¶ˆè´¹æ–¹: PRD2JSONï¼ˆä¸å†ä¿®æ”¹ prd.mdï¼‰
```

PRD2JSON å½“å‰ä¿®æ”¹è¡Œä¸º â†’ æ”¹ä¸ºåªè¯»:
```
v1 (ä¿®æ”¹ prd.md):
  1. è¯» prd.md Â§7
  2. æ‰«æ rules/ â†’ ç”¨æˆ·ç¡®è®¤
  3. æ³¨å…¥ [è§„èŒƒ] æ¡ç›®åˆ° prd.md Â§7  â† å‰¯ä½œç”¨ï¼
  4. è¡Œå·å…¨å˜ â†’ å¿…é¡»é‡æ–°æ‰«æ prdSection  â† è„†å¼±ï¼

v2 (åªè¯» prd.md):
  1. è¯» prd.md Â§7ï¼ˆåªè¯»ï¼‰
  2. ä» journal è¯»å– R1 è§„èŒƒç»“æœï¼ˆé›¶ç”¨æˆ·äº¤äº’ï¼‰
  3. ç”Ÿæˆ dev.jsonï¼Œåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ç›´æ¥å°† [è§„èŒƒ] æ³¨å…¥ AC[]
     â†’ prd.md ä¸è¢«ä¿®æ”¹ï¼Œé›¶å‰¯ä½œç”¨
```

**PRDReview ä¿ç•™è¦†ç›–èƒ½åŠ›ï¼ˆä¼˜å…ˆ UXï¼‰**:
```
v1 (å¯ä¿®æ”¹ prd.md):
  Codex å®¡æŸ¥ â†’ Claude ä¿®å¤ â†’ review-save API è¦†ç›– prd.md

v2 (ä¿ç•™è¦†ç›–ï¼Œä¼˜å…ˆ UX):
  Codex å®¡æŸ¥ â†’ Claude ä¿®å¤ â†’ ç”¨æˆ·ç¡®è®¤é‡‡çº³
  â†’ è¦†ç›– prd.mdï¼ˆæ ‡è®°ä¸º reviewed ç‰ˆæœ¬ï¼‰
  â†’ åŒæ—¶ä¿ç•™ prd-review-fixed.mdï¼ˆä¿®å¤ diff è®°å½•ï¼‰
  â†’ å¦‚æœ PRD2JSON å·²è¿è¡Œï¼Œæç¤ºç”¨æˆ·é‡è·‘ /prd2json ä»¥åŒæ­¥ dev.json
```

**æ ¸å¿ƒåŸåˆ™**:
- PRD2JSON å¯¹ prd.md é›¶å†™å…¥ï¼ˆæ¶ˆé™¤ [è§„èŒƒ] æ³¨å…¥å‰¯ä½œç”¨ + è¡Œå·æ¼‚ç§»ï¼‰
- PRDReview ä¿ç•™è¦†ç›–èƒ½åŠ›ä»¥ç»´æŒ UX æµç•…åº¦ï¼Œä½†è¦†ç›–åéœ€æç¤ºä¸‹æ¸¸åŒæ­¥
- ç›¸æ¯” v1 ä¸‰æ–¹éšæ„å†™ï¼Œv2 æ”¶ç´§åˆ°ä¸¤æ–¹ï¼ˆPyramidPRD ä¸»å†™ + PRDReview å—æ§å†™ï¼‰ï¼ŒPRD2JSON å®Œå…¨åªè¯»

**ADR-5: Q&A Journal æŒä¹…åŒ–**
```
å†³ç­–: æ¯å±‚é—®ç­”ç»“æŸåå†™å…¥ qa-journal.mdï¼Œä¸‹å±‚ä»æ–‡ä»¶æ¢å¤ä¸Šä¸‹æ–‡
è·¯å¾„: tasks/<projectId>/qa-journal.md
æ•ˆæœ: æ¯å±‚ä¸Šä¸‹æ–‡ä»çº¿æ€§ç´¯ç§¯ï¼ˆ~150KBï¼‰é™åˆ° journal æ–‡ä»¶(~3KB) + å½“å‰å±‚(~5KB) â‰ˆ 8KB
```

**ADR-6: Subagent ç®¡çº¿ï¼ˆé‡æ´»å§”æ´¾ï¼‰**
```
å†³ç­–: ä»£ç æ‰«æã€PRD ç”Ÿæˆã€Transform æºæ–‡ä»¶åˆ†æå§”æ´¾ç»™ subagent
ä¸»å¯¹è¯åªåš: ç¼–æ’ + ç”¨æˆ·äº¤äº’ (AskUserQuestion)
```

| é˜¶æ®µ | Subagent ç±»å‹ | è¾“å…¥ â†’ è¾“å‡º | ä¸»å¯¹è¯èŠ‚çœ |
|------|-------------|-------------|-----------|
| S1 ä»£ç æ‰«æï¼ˆå…¨æ¨¡å¼å…±äº«ï¼‰ | `Explore` | é¡¹ç›®ç›®å½• â†’ `codebase-scan.md` | 30-50KB |
| G1/W1 PRD ç”Ÿæˆ | `general-purpose` | journal + scan â†’ `prd.md` | 10-30KB |
| Transform Ti+Ta æºæ–‡ä»¶åˆ†æ | `Explore` | æº PRD â†’ `source-analysis.md` | 50-100KB |
| Transform Tf æ¯”å¯¹ | `general-purpose` | æº PRD + ç”Ÿæˆ PRD â†’ æ¯”å¯¹æŠ¥å‘Š | 15-30KB |

**ADR-7: å¤§æ–‡ä»¶ Master Context + Phase Bundle**
```
å†³ç­–:
  < 2000 è¡Œ â†’ å½“å‰ Transform æµç¨‹ï¼ˆJournal + Subagent ä¼˜åŒ–åå¤Ÿç”¨ï¼‰
  2000-5000 è¡Œ â†’ å•æºå¤šéæŠ½å–ï¼ˆC2ï¼Œ4 ä¸ª Explore subagent æŒ‰ç»´åº¦æå–ï¼‰
  > 5000 è¡Œ â†’ Master Context + Phase Bundleï¼ˆC1ï¼Œè‡ªåŒ…å«åˆ†åŒ… + å¹¶è¡Œå¤„ç†ï¼‰
```

**ADR-8: PRDReview ç²¾ç®€ + A2 Checklist æ‰©å±•**
```
å†³ç­–:
1. PRDReview ç²¾ç®€ä¸ºåŒæ¨¡å¼ï¼ˆA1 è‡ªåŠ¨ + Standaloneï¼‰ï¼Œåˆ é™¤ç‹¬ç«‹é¡¹ç›®å®¡æŸ¥æ¨¡å¼
2. PRDReview A1 ä¿ç•™ review-save è¦†ç›– prd.md èƒ½åŠ›ï¼ˆauto-chain å†…è‡ªåŠ¨è¦†ç›–ï¼‰
3. Standalone æ¨¡å¼å¤‡ä»½ {stem}_original.md â†’ è¦†ç›–åŸæ–‡ä»¶ â†’ äº§å‡º {stem}_review.json
4. åŸ Enrich å®¡æŸ¥ç»´åº¦ç§»å…¥ A2 Checklist: 17â†’18 é¡¹ï¼ˆ+prd-dev-consistencyï¼‰
5. PRDReview å†…éƒ¨å®¡æŸ¥é€»è¾‘ï¼ˆCodex æ•Œå¯¹å¾ªç¯ã€é™çº§æ¨¡å¼ã€Circuit Breakerï¼‰ä¿æŒä¸å˜
```

**ADR-9: æ–¹æ¡ˆå¡æ‰¹é‡ç¡®è®¤ï¼ˆé—®ç­”åŠ é€Ÿï¼‰**
```
å†³ç­–: L1-L4 æ¯å±‚çš„å¤šä¸ª AskUserQuestion åˆå¹¶ä¸º 1 ä¸ªæ–¹æ¡ˆå¡
æ¯ä¸ªé—®é¢˜å¼ºåˆ¶å« AI æ¨èï¼Œç”¨æˆ·å¯å…¨éƒ¨æ¥å—æˆ–ç²¾å‡†ä¿®æ”¹
L0 æ–¹å‘æ¢ç´¢å’Œ L5 ç¡®è®¤é—¨æ§ä¿æŒä¸å˜ï¼ˆæˆ˜ç•¥å†³ç­–/æœ€ç»ˆç¡®è®¤ä¸é€‚åˆæ‰¹é‡åŒ–ï¼‰
é€ƒç”Ÿå£: æ¯å¼ æ–¹æ¡ˆå¡å«"æ–¹å‘ä¸å¯¹ï¼Œé‡æ–°ç”Ÿæˆ"é€‰é¡¹
å›æ˜¾ç¡®è®¤: ä¿®æ”¹æŒ‡ä»¤è§£æåå¿…é¡»å…ˆå›æ˜¾å†æ‰§è¡Œ
é€‚ç”¨æ¨¡å¼: å®Œæ•´è§„åˆ’(L1-L4)ã€åŠŸèƒ½å¼€å‘(L1+L4)ã€Transform(Tq è¡¥å……æ–¹æ¡ˆå¡)
```

**äº¤äº’æ¬¡æ•°å¯¹æ¯”ï¼ˆv1 é€é¢˜ vs v2 æ–¹æ¡ˆå¡ï¼‰**:

| å±‚çº§ | v1(é€é¢˜) | v2(æ–¹æ¡ˆå¡) |
|------|---------|-----------|
| Phase 0 æ¨¡å¼é€‰æ‹© | 1 æ¬¡ | 1 æ¬¡ |
| L0 æ–¹å‘æ¢ç´¢ | 2-3 æ¬¡ | 2 æ¬¡ |
| L1 æ ¸å¿ƒè¯†åˆ« | 4-7 æ¬¡ | **1 æ¬¡** |
| ä»£ç æ‰«æ | 0 æ¬¡ | 0 æ¬¡ |
| L2 é¢†åŸŸåˆ†æ”¯ | 5-12 æ¬¡ | **1 æ¬¡** |
| L3 ç»†èŠ‚æ·±å…¥ | 5-12 æ¬¡ | **1 æ¬¡** |
| L4 è¾¹ç•Œç¡®è®¤ | 4-7 æ¬¡ | **1 æ¬¡** |
| L5 ç¡®è®¤é—¨æ§ | 2 æ¬¡ | 2 æ¬¡ |
| **æ€»è®¡** | **23-44 æ¬¡** | **~9 æ¬¡** |

**æ—¶é—´ä¼°ç®—**:
- v1 å®Œæ•´è§„åˆ’: ~30-45 åˆ†é’Ÿ
- v2 æ–¹æ¡ˆå¡å®Œæ•´è§„åˆ’: ~8-12 åˆ†é’Ÿ
- v2 åŠŸèƒ½å¼€å‘: ~5-8 åˆ†é’Ÿ

**ADR-10: R1 è§„èŒƒç¡®è®¤å‰ç½®ï¼ˆä» PRD2JSON ç§»è‡³ PyramidPRDï¼Œå…¨æ¨¡å¼å…±äº«ï¼‰**
```
å†³ç­–: å°†è§„èŒƒï¼ˆrules/ï¼‰æ‰«æå’Œç”¨æˆ·ç¡®è®¤ç¯èŠ‚ä» PRD2JSON ç§»è‡³ PyramidPRD
ä½ç½®: ä»£ç æ‰«æ(S1) ä¹‹åçš„ R1 é˜¶æ®µï¼ˆå…¨æ¨¡å¼å…±äº«ï¼‰
  å®Œæ•´è§„åˆ’ / åŠŸèƒ½å¼€å‘: S1 â†’ R1 â†’ L1 æ–¹æ¡ˆå¡
  Transform: Ti â†’ S1 â†’ R1 â†’ Ta ç»“æ„å‘ç°
ç¡®è®¤ç»“æœå†™å…¥ qa-journal.mdï¼ŒPRD2JSON ç›´æ¥è¯»å–ï¼ˆé›¶äº¤äº’ï¼‰
```

### 3.3 æ–‡ä»¶ä¸»æƒçŸ©é˜µ

| æ–‡ä»¶ | å†™å…¥æ–¹ | åªè¯»æ¶ˆè´¹æ–¹ | v1 å¯¹æ¯” |
|------|-------|-----------|---------|
| `prd.md` | PyramidPRD(ä¸»), PRDReview(å—æ§è¦†ç›–) | PRD2JSON, Lead(designRefs), äººç±» | v1: ä¸‰æ–¹å¯å†™ â†’ v2: ä¸¤æ–¹åˆ†çº§å†™ |
| `dev.json` | PRD2JSON | Lead, Testing, Coding, Finalize, BotoolAgent.sh | v1: prd.json ä¸¤æ–¹å†™ â†’ v2: ä¸€æ–¹å†™ |
| `registry.json` | PRD2JSON(åˆå§‹åŒ–), Finalize(statusæ›´æ–°) | Coding, BotoolAgent.sh, Viewer | v1: ä¸¤æ–¹å†™ â†’ v2: ä¸¤æ–¹åˆ†å­—æ®µå†™(ä¸é‡å ) |
| `prd-review.json` | PRDReview | äººç±», Viewer UI | ä¸å˜ |
| `prd-review-fixed.md` | PRDReview | äººç±» | ä¿®å¤ diff è®°å½• |
| `prd-completeness-report.md` | PyramidPRD(Tf) | äººç±» | v2: å†™å…¥æ–¹ä» PRD2JSON ç§»è‡³ PyramidPRD Tf |
| `progress.txt` | PRD2JSON(é‡ç½®), Lead(append), BotoolAgent.sh(append) | Viewer | PRD2JSON é¡¹ç›®åˆå§‹åŒ–é‡ç½® |
| `agent-status` | BotoolAgent.sh | Finalize, Viewer | ä¸å˜ |
| `PROJECT.md` | PyramidPRD (ä»£ç æ‰«æ) | äººç±» | ä¸å˜ |
| `qa-journal.md` | PyramidPRD ä¸»å¯¹è¯ | PyramidPRD å„å±‚ + PRD Subagent + PRD2JSON(A2) | æ–°å¢ |

### 3.4 ç®¡çº¿ç¼–æ’æµç¨‹

**CLI é“¾è·¯ï¼ˆv2 æ¨èé¡ºåº â€” Ralph è‡ªåŠ¨ç®¡çº¿ï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·äº¤äº’åŒºï¼ˆHuman-in-the-loopï¼‰              â”‚
â”‚                                                 â”‚
â”‚  PyramidPRD ä¸»å¯¹è¯ (~50KB)                       â”‚
â”‚    P0 æ¨¡å¼é€‰æ‹© â†’ L0 æ–¹å‘ â†’ S1 ä»£ç æ‰«æ           â”‚
â”‚    â†’ R1 è§„èŒƒç¡®è®¤ â†’ L1-L4 æ–¹æ¡ˆå¡ â†’ L5 ç¡®è®¤é—¨æ§    â”‚
â”‚    â†’ G1/W1 PRD ç”Ÿæˆ â†’ Tf å®Œæ•´æ€§é—¨æ§              â”‚
â”‚                                                 â”‚
â”‚  âœ… PyramidPRD è¿”å›ï¼Œç”¨æˆ·å¯ç»§ç»­å…¶ä»–å·¥ä½œ            â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    PRDing Ralphï¼ˆBackground Agent ç¼–æ’å™¨ï¼‰     â”‚
â”‚    ç‹¬ç«‹ context (~245KB budget)                  â”‚
â”‚                                                 â”‚
â”‚  A1: PRDReview (è‡ªåŠ¨å®¡æŸ¥)                         â”‚
â”‚    â†’ Codex æ•Œå¯¹å®¡æŸ¥ â†’ ä¿®å¤ â†’ è¦†ç›– prd.md          â”‚
â”‚    â†’ Circuit Breaker: é»˜è®¤ accept + advisory     â”‚
â”‚                                                 â”‚
â”‚  A2: PRD2JSON (è‡ªåŠ¨è½¬æ¢)                          â”‚
â”‚    â†’ è¯» prd.md(reviewed) + journal(R1è§„èŒƒ)       â”‚
â”‚    â†’ ç”Ÿæˆ dev.json (fat) + registry.json          â”‚
â”‚    â†’ 18 é¡¹ Checklist æ ¡éªŒ                         â”‚
â”‚                                                 â”‚
â”‚  å®Œæˆ â†’ é€šçŸ¥ç”¨æˆ· "PRD å®¡æŸ¥+è½¬æ¢å®Œæˆ"               â”‚
â”‚  å¤±è´¥ â†’ é€šçŸ¥ç”¨æˆ· + æ‰“å°æ¢å¤æŒ‡ä»¤                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Standalone ä»»æ„æ–‡ä»¶å®¡æŸ¥**:
```
ç”¨æˆ·æ‰‹åŠ¨ /prdreview /path/to/doc.md â†’ å®Œæ•´ Codex æ•Œå¯¹å¾ªç¯
  â”œâ”€ æ£€æµ‹: å‚æ•°å« / æˆ–ä»¥ .md ç»“å°¾ â†’ standalone æ¨¡å¼
  â”œâ”€ READ: /path/to/doc.md (ä¸åš registry æŸ¥æ‰¾)
  â”œâ”€ BACKUP: /path/to/doc_original.md (åŸæ–‡ä»¶å¤‡ä»½)
  â”œâ”€ Codex æ•Œå¯¹å®¡æŸ¥ (5 ç»´åº¦: completeness/consistency/implementability/security/ux)
  â”œâ”€ æ•Œå¯¹å¾ªç¯ max 3 è½® (Fix/Argue Rejection)
  â”œâ”€ WRITE: /path/to/doc.md (ä¿®å¤åè¦†ç›–åŸæ–‡ä»¶)
  â””â”€ WRITE: /path/to/doc_review.json (å®¡æŸ¥æŠ¥å‘Š)
```

### 3.5 Subagent ç®¡çº¿æ¶æ„

**å®Œæ•´è§„åˆ’ / åŠŸèƒ½å¼€å‘ï¼š**
```
ä¸»å¯¹è¯ï¼ˆç²¾ç®€ç¼–æ’å™¨, ä¸Šä¸‹æ–‡æ§åˆ¶åœ¨ ~50KBï¼‰
  â”‚
  â”œâ”€ P0: æ¨¡å¼é€‰æ‹© â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (AskUserQuestion)
  â”œâ”€ L0 æ–¹å‘æ¢ç´¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (AskUserQuestion â†’ Write journal)
  â”œâ”€ S1 ä»£ç æ‰«æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Explore Subagent âš¡ â†’ codebase-scan.md
  â”œâ”€ R1 è§„èŒƒç¡®è®¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (æ‰«æ rules/ â†’ AskUserQuestion â†’ Write journal)
  â”œâ”€ L1-L4 æ–¹æ¡ˆå¡ç¡®è®¤ â”€â”€â”€â”€ ä¸»å¯¹è¯ (æ¯å±‚ Read journal â†’ æ–¹æ¡ˆå¡ â†’ Write journal)
  â”œâ”€ Phase 5.5 å¤–éƒ¨ä¾èµ– â”€â”€ ä¸»å¯¹è¯ (prerequisites â†’ Write journal)
  â”œâ”€ L5 ç¡®è®¤é—¨æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (Read journal + scan â†’ ASCII â†’ Ask)
  â”œâ”€ G1/W1 PRD ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€ general-purpose Subagent âš¡ â†’ prd.md
  â”œâ”€ Tf å®Œæ•´æ€§é—¨æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ general-purpose Subagent âš¡ â†’ æ¯”å¯¹+è‡ªåŠ¨è¡¥å……
  â”‚
  â””â”€ Task(run_in_background) â†’ PRDing Ralph ç¼–æ’å™¨ âš¡âš¡
       â”‚  ç‹¬ç«‹ context (~245KB budget)
       â”œâ”€ A1 è‡ªåŠ¨å®¡æŸ¥ â”€â”€â”€ Skill("prdreview") â†’ prd.md(reviewed)
       â””â”€ A2 è‡ªåŠ¨è½¬æ¢ â”€â”€â”€ Skill("prd2json") â†’ dev.json
```

**Transformï¼ˆå¯¼å…¥æ¨¡å¼ï¼‰ï¼š**
```
ä¸»å¯¹è¯ï¼ˆç²¾ç®€ç¼–æ’å™¨, ä¸Šä¸‹æ–‡æ§åˆ¶åœ¨ ~60KBï¼‰
  â”‚
  â”œâ”€ P0: æ¨¡å¼é€‰æ‹© â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (AskUserQuestion)
  â”œâ”€ Ti æºæ–‡ä»¶è·å– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (éªŒè¯æº PRD + é¢„æ‰«æåŸºå‡†)
  â”œâ”€ S1 ä»£ç æ‰«æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Explore Subagent âš¡ â†’ codebase-scan.md
  â”œâ”€ R1 è§„èŒƒç¡®è®¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (æ‰«æ rules/ â†’ AskUserQuestion â†’ Write journal)
  â”œâ”€ Ta ç»“æ„å‘ç° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Explore Subagent âš¡ â†’ source-analysis.md
  â”œâ”€ Tv å®Œæ•´æ€§æ ¡éªŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (å¤§æ–‡ä»¶å¿…æ‰§è¡Œ)
  â”œâ”€ Tq è¦†ç›–åº¦+è¡¥å……é—®ç­” â”€â”€ ä¸»å¯¹è¯ (æ–¹æ¡ˆå¡, ä»… PARTIAL/SPARSE ç»´åº¦)
  â”œâ”€ Tg DT åˆ†è§£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (Phaseâ†’DT æ‹†è§£, å‚è€ƒ S1 ç»“æœ)
  â”œâ”€ Phase 5.5 å¤–éƒ¨ä¾èµ– â”€â”€ ä¸»å¯¹è¯ (prerequisites â†’ Write journal)
  â”œâ”€ L5 ç¡®è®¤é—¨æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»å¯¹è¯ (Read journal + scan â†’ ASCII â†’ Ask)
  â”œâ”€ G1/W1 PRD ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€ general-purpose Subagent âš¡ â†’ prd.md
  â”œâ”€ Tf å®Œæ•´æ€§é—¨æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ general-purpose Subagent âš¡ â†’ æ¯”å¯¹+è‡ªåŠ¨è¡¥å……
  â”‚
  â””â”€ Task(run_in_background) â†’ PRDing Ralph ç¼–æ’å™¨ âš¡âš¡
       â”œâ”€ A1 è‡ªåŠ¨å®¡æŸ¥ â”€â”€â”€ Skill("prdreview") â†’ prd.md(reviewed)
       â””â”€ A2 è‡ªåŠ¨è½¬æ¢ â”€â”€â”€ Skill("prd2json") â†’ dev.json
```

**ä¸‰æ¨¡å¼å…±äº«é˜¶æ®µä¸€è§ˆ**:
```
P0 â†’ S1 â†’ R1 â†’ [æ¨¡å¼ç‰¹å®š] â†’ Phase 5.5 â†’ L5 â†’ G1/W1 â†’ Tf â†’ [Ralph: A1 â†’ A2]
                                                              â””â”€ background
```

### 3.6 å¤§æ–‡ä»¶ Transform æ¶æ„

**C1: Master Context + Phase Bundleï¼ˆ> 5000 è¡Œï¼‰**:
```
ç¬¬ä¸€é: Explore Subagent â†’ master-context.md (~500 è¡Œ)
  - é¡¹ç›®æ¦‚è¿°ï¼ˆå‹ç¼©ä¸ºæ‘˜è¦ï¼‰
  - å…¨éƒ¨ CREATE TABLEï¼ˆå®Œæ•´ä¿ç•™ï¼‰
  - æ¶æ„è®¾è®¡ï¼ˆçŠ¶æ€æœºã€è§’è‰²æƒé™çŸ©é˜µï¼‰
  - å…¨å±€ä¸šåŠ¡è§„åˆ™ï¼ˆè·¨ Phase çº¦æŸï¼‰
  - æŠ€æœ¯æ ˆå£°æ˜

ç¬¬äºŒé: æŒ‰ Phase åˆ›å»ºè‡ªåŒ…å«åˆ†åŒ…
  å¯¹æº PRD æ¯ä¸ª Phaseï¼ˆæˆ– 2-3 ä¸ªç›¸å…³ Phase åˆå¹¶ï¼‰:
    phase-bundle-N.md = master-context.md (å®Œæ•´åµŒå…¥)
      + Phase N åŸæ–‡ (å®Œæ•´)
      + Phase N å¼•ç”¨çš„è¡¨/è§„åˆ™/UIï¼ˆç²¾é€‰ï¼‰
    æ¯ä¸ªåˆ†åŒ… ~800-1300 è¡Œ

ç¬¬ä¸‰é: å¹¶è¡Œ Subagent å¤„ç†ï¼ˆâ‰¤ 4 å¹¶è¡Œï¼‰
  ä¸»å¯¹è¯å¹¶è¡Œå¯åŠ¨ N ä¸ª general-purpose Subagent

ç¬¬å››é: åˆå¹¶æ ¡éªŒ
  åˆå¹¶æ‰€æœ‰ prd-phase-N.md â†’ æœ€ç»ˆ prd.md
  å†²çªæ£€æµ‹ + CREATE TABLE å®Œæ•´æ€§ + è¡Œæ•°æ ¡éªŒ
```

**C2: å•æºå¤šéæŠ½å–ï¼ˆ2000-5000 è¡Œï¼‰**:
```
Explore Subagent A: æå– Â§4 æ•°æ®è®¾è®¡ â†’ data-extraction.md
Explore Subagent B: æå– Â§3+Â§6 æ¶æ„+è§„åˆ™ â†’ arch-rules-extraction.md
Explore Subagent C: æå– Â§5+Â§8 UI+é™„å½• â†’ ui-appendix-extraction.md
Explore Subagent D: æå– Â§7/Â§9 å¼€å‘è®¡åˆ’ â†’ plan-extraction.md

ä¸»å¯¹è¯: Read 4 ä¸ªæå–æ–‡ä»¶ â†’ L5 ç¡®è®¤ â†’ Subagent ç”Ÿæˆ PRD
```

## 4. æ•°æ®è®¾è®¡

### 4.1 dev.json Schema

```json
{
  "project": "string (å¿…å¡«)",
  "branchName": "string (å¿…å¡«)",
  "description": "string (å¿…å¡«)",
  "prdFile": "tasks/<id>/prd.md (å¿…å¡«)",
  "prerequisites": [],
  "sessions": [],
  "constitution": {
    "rules": [
      {
        "id": "rule-001",
        "name": "string",
        "category": "string",
        "file": "rules/xxx.md",
        "checklist": ["string"]
      }
    ],
    "ruleAuditSummary": ""
  },
  "devTasks": [
    {
      "id": "DT-001",
      "title": "string (å¿…å¡«)",
      "priority": 1,
      "passes": false,
      "dependsOn": [],
      "description": "string (å¿…å¡«, â‰¥2 å¥è¯å®Œæ•´æè¿°)",
      "acceptanceCriteria": [
        "å…³é”®å­—æ®µ xxx å­˜åœ¨äº CREATE TABLE",
        "[è§„èŒƒ] æ‰€æœ‰è¯·æ±‚å¸¦ apikey header",
        "Typecheck passes"
      ],
      "designRefs": ["Â§4.2 æ•°æ®æ¨¡å‹æ¦‚è§ˆ", "Â§3.3 çŠ¶æ€æœº"],
      "files": ["sql/04_versions.sql (å¯é€‰)"],
      "evals": [{ "type": "code-based", "command": "npx tsc --noEmit", "expect": "exit-0" }],
      "testCases": [
        { "type": "typecheck", "desc": "TypeScript ç¼–è¯‘é€šè¿‡" },
        { "type": "e2e", "desc": "...", "playwrightMcp": { "url": "/admin", "steps": [] } }
      ],
      "steps": [{ "action": "create", "file": "...", "description": "..." }]
    }
  ]
}
```

### 4.2 å­—æ®µå˜åŒ–å¯¹æ¯”

| å­—æ®µ | å½“å‰ prd.json | æ–° dev.json | å˜åŒ–è¯´æ˜ |
|------|--------------|-------------|---------|
| `DT.prdSection` | âœ… è¡Œå·æŒ‡é’ˆ | â›” **åˆ é™¤** | è¢« designRefs æ›¿ä»£ |
| `DT.description` | å¯é€‰ | ğŸ”¼ **å¿…å¡«** | Lead Agent ç›´æ¥è¯»ï¼Œæ— éœ€è·³è¯» |
| `DT.acceptanceCriteria[]` | å¯é€‰ | ğŸ”¼ **å¿…å¡«** | å­—æ®µçº§ + [è§„èŒƒ] æ¡ç›® |
| `DT.designRefs[]` | âŒ | ğŸ†• **å¿…å¡«** | æ ‡é¢˜å…³é”®è¯æ ¼å¼ "Â§X.Y åç§°"ï¼ŒæŠ—è¡Œå·æ¼‚ç§» |
| `DT.files[]` | âŒ | ğŸ†• å¯é€‰ | é¢„æœŸäº§å‡ºæ–‡ä»¶ |
| `constitutionFusedAt` | âœ… | â›” åˆ é™¤ | write-onlyï¼Œé›¶æ¶ˆè´¹æ–¹ |
| `knownGaps[]` | âœ… | â›” åˆ é™¤ | æ”¹å†™å…¥ prd-completeness-report.md |

### 4.3 18 é¡¹ Checklist

**Checklist Before Savingï¼ˆ18 é¡¹ï¼Œä»»ä¸€å¤±è´¥ â†’ æ‹’ç»ä¿å­˜ï¼‰:**

1. Previous run archivedï¼ˆæ—§ prd.json/dev.json ä¸” branchName ä¸åŒ â†’ archive/ï¼‰
2. prdFile æŒ‡å‘æ­£ç¡® PRD è·¯å¾„
3. **æ¯ä¸ª DT æœ‰ descriptionï¼ˆâ‰¥ 2 å¥è¯ï¼‰**
4. **æ¯ä¸ª DT æœ‰ acceptanceCriteria[]ï¼ˆâ‰¥ 3 æ¡ï¼‰**
5. **æ¯ä¸ª DT æœ‰ designRefs[]ï¼ˆâ‰¥ 1 æ¡ï¼‰**
6. Each task completable in one iteration
7. Tasks ordered by dependency
8. Every task has at least one evalï¼ˆtypecheckï¼‰
9. Sessions max 8 tasks
10. **è§„èŒƒèåˆå®Œæˆ**: æœ‰ rules/ æ—¶æ¯ä¸ªåŒ¹é… DT æœ‰ [è§„èŒƒ] AC
11. Constitution ä½¿ç”¨ file+checklistï¼ˆ3-8 æ¡ï¼‰
12. Steps é¢—ç²’åº¦ï¼ˆ3-6 æ­¥ï¼‰
13. **testCases éç©º**: æ¯ä¸ª DT è‡³å°‘ typecheckï¼›UI/API DT è‡³å°‘ e2e
14. **playwrightMcp å·²æ³¨å…¥**: e2e å¿…é¡» playwrightMcpï¼›steps 3-8ï¼›url ç›¸å¯¹è·¯å¾„
15. registry.json å·²æ›´æ–°ï¼ˆdevJson å­—æ®µï¼‰
16. **field-completeness**: æ¯ä¸ª DT çš„ description(â‰¥2å¥), AC[](â‰¥3æ¡), designRefs[](â‰¥1æ¡) å‡è¾¾æ ‡
17. **designRef-validity**: æ¯ä¸ª designRefs "Â§X.Y åç§°" åœ¨ prd.md ä¸­å®é™…å­˜åœ¨
18. **prd-dev-consistency**: prd.md Â§7 vs dev.json DT æ•°é‡/Phase ç»“æ„ä¸€è‡´æ€§

### 4.4 Q&A Journal æ ¼å¼

**è·¯å¾„**: `tasks/<projectId>/qa-journal.md`

```markdown
# Q&A Journal â€” [é¡¹ç›®å]
> æ¨¡å¼: åŠŸèƒ½å¼€å‘ | å¤æ‚åº¦: ä¸­ç­‰

## L0 æ–¹å‘æ¢ç´¢
- é€‰å®šæ–¹å‘: æ–¹å‘ A â€” [ä¸€å¥è¯]
- å®ç°æ€è·¯: [æŠ€æœ¯æ–¹æ¡ˆ]
- èŒƒå›´: âœ… [è¦åš] / âŒ [ä¸åš]
- æŠ€æœ¯æ ˆ: Next.js + TypeScript + Prisma

## S1 ä»£ç æ‰«ææ‘˜è¦
> æ¥æº: codebase-scan.md (Subagent äº§å‡º)
- æŠ€æœ¯æ ˆ: [æ¡†æ¶ + è¯­è¨€ + æ•°æ®åº“]
- å…³é”®æ¨¡å—: [ç»„ä»¶åˆ—è¡¨]
- å·²æœ‰ API: [ç«¯ç‚¹åˆ—è¡¨]

## R1 è§„èŒƒç¡®è®¤
- å·²ç¡®è®¤è§„èŒƒ:
  - rules/backend/api-rules.md âœ…
  - rules/frontend/ui-rules.md âœ…
- æ’é™¤: æ— 
- ç¡®è®¤æ–¹å¼: å…¨éƒ¨ä¿ç•™(æ¨è)

## L1 æ–¹æ¡ˆå¡
- Q1 é—®é¢˜åŸŸ: A â€” [é€‰å®šç­”æ¡ˆ]
- Q2 ç›®æ ‡ç”¨æˆ·: A â€” [é€‰å®šç­”æ¡ˆ]
- ä¿®æ”¹: æ—  / "Q3 æ¢ B"

## L2 æ–¹æ¡ˆå¡
- Q1 é¡µé¢ç»“æ„: B â€” ç®¡ç†é¢æ¿
- Q2 API è®¾è®¡: A â€” RESTful
...
```

### 4.5 è§„èŒƒèåˆæµç¨‹ï¼ˆPRD2JSON å†…éƒ¨ï¼Œå…¨è‡ªåŠ¨ï¼‰

```
Step A: ä» qa-journal.md è¯»å– R1 è§„èŒƒç¡®è®¤ç»“æœ
  â†’ journal ä¸­æœ‰ "## R1 è§„èŒƒç¡®è®¤" æ®µè½ï¼Œå«å·²ç¡®è®¤çš„è§„èŒƒåˆ—è¡¨
  â†’ æ—  journal / æ—  R1 æ®µè½ â†’ æ‰«æ rules/ ç›®å½•ï¼Œè‡ªåŠ¨ä¿ç•™å…¨éƒ¨ï¼ˆé›¶äº¤äº’ï¼‰

Step B: è¯»å–è§„èŒƒ + ç”Ÿæˆ constitution
  æ¯æ¡è§„èŒƒ: Read â†’ æå– 3-8 æ¡ checklist â†’ å†™å…¥ constitution.rules

Step C: ç”Ÿæˆ dev.json æ—¶èåˆè§„èŒƒ
  å¯¹æ¯ä¸ª DT:
    æ ¹æ®å…³é”®è¯åŒ¹é…é€‚ç”¨è§„èŒƒ (APIâ†’API_Rules, DBâ†’DB_Rules, etc.)
    åœ¨ acceptanceCriteria[] ä¸­è¿½åŠ  "[è§„èŒƒ] å…·ä½“æ¡ç›®"
  â†’ prd.md ä¸è¢«ä¿®æ”¹ï¼ˆåªè¯»æ¶ˆè´¹æ–¹ï¼‰
  â†’ å…¨ç¨‹é›¶ç”¨æˆ·äº¤äº’
```

### 4.6 testCases + playwrightMcp è§„åˆ™ï¼ˆä¿ç•™ä¸å˜ï¼‰

| ä»»åŠ¡ç±»å‹ | è§¦å‘æ¡ä»¶ | å¿…é¡»åŒ…å« |
|---------|---------|---------|
| typecheck | æ‰€æœ‰ DT | `{ type: "typecheck", desc: "..." }` |
| e2e | æ¶‰åŠ UI/API çš„ DT | `{ type: "e2e", playwrightMcp: { url, steps[] } }` |
| unit | æ¶‰åŠçº¯é€»è¾‘çš„ DT | `{ type: "unit", desc: "...", tdd: true }` |

playwrightMcp 8 ç§ action: navigate / snapshot / click / fill / wait_for / assert_visible / assert_not_visible / screenshot

### 4.7 å®Œæ•´æ€§æ¯”å¯¹ï¼ˆPyramidPRD Tf æ‰§è¡Œï¼‰

- **æ‰§è¡Œä½ç½®**: PyramidPRD Tf é˜¶æ®µï¼ˆG1/W1 PRD ç”Ÿæˆåã€A1 PRDReview å‰ï¼‰
- **èŒè´£å½’å±**: PyramidPRD è´Ÿè´£ prd.md è´¨é‡ï¼ŒPRD2JSON ä¸å†åšæºæ–‡ä»¶æ¯”å¯¹
- è§¦å‘æ¡ä»¶: Transform æ¨¡å¼æœ‰ SOURCE_PRD.ref æ—¶è‡ªåŠ¨æ‰§è¡Œï¼›åŸåˆ›æ¨¡å¼æœ‰ DRAFT.md æ—¶è‡ªåŠ¨æ‰§è¡Œ
- å¯¹æ¯”ç»´åº¦: æ•°æ®è¡¨ï¼ˆå­—æ®µçº§ï¼‰ã€åŠŸèƒ½ç‚¹ã€API ç«¯ç‚¹ã€ä¸šåŠ¡è§„åˆ™ã€Phase å®Œæ•´æ€§
- æŠ¥å‘Šè¾“å‡º: `prd-completeness-report.md`
- FAIL â†’ è‡ªåŠ¨è¡¥å…… prd.mdï¼ˆTf æœ‰å†™å…¥æƒé™ï¼‰â†’ é‡æ–°æ ¡éªŒï¼ˆæœ€å¤š 2 è½®ï¼‰

## 5. UI è®¾è®¡

### 5.1 æ–¹æ¡ˆå¡æ ¸å¿ƒè®¾è®¡

æ¯å±‚é—®ç­”ä» N ä¸ª AskUserQuestion åˆå¹¶ä¸º 1 ä¸ªæ–¹æ¡ˆå¡ã€‚æ–¹æ¡ˆå¡åœ¨ question æ–‡æœ¬ä¸­åˆ—å‡ºæ‰€æœ‰é—®é¢˜ã€æ‰€æœ‰é€‰é¡¹å’Œ AI æ¨èï¼Œç”¨æˆ·åªéœ€é€‰æ‹©ã€Œå…¨éƒ¨æ¥å—ã€æˆ–è¾“å…¥ä¿®æ”¹æŒ‡ä»¤ã€‚

**æ–¹æ¡ˆå¡æ¨¡æ¿**:
```
ã€L2: é¢†åŸŸåˆ†æ”¯ â€” AI æ–¹æ¡ˆå¡ã€‘

åŸºäº: [L0æ–¹å‘] + [L1æ ¸å¿ƒ] + [ä»£ç æ‰«æç»“æœ]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

 Q1. é¡µé¢ç»“æ„
   A) å•é¡µåº”ç”¨ â€” å…¨éƒ¨åŠŸèƒ½åœ¨ä¸€ä¸ªé¡µé¢å†…
   B) ç®¡ç†é¢æ¿ â€” å·¦ä¾§å¯¼èˆª + å³ä¾§å†…å®¹åŒº  â† åŒ¹é…ç°æœ‰ viewer
   C) å¤šæ ‡ç­¾é¡µ â€” é¡¶éƒ¨ Tab åˆ‡æ¢ä¸åŒåŠŸèƒ½åŒº
   â†’ AI é€‰æ‹©: B

 Q2. API è®¾è®¡æ¨¡å¼
   A) RESTful è·¯ç”± (GET/POST/PUT/DELETE)  â† åŒ¹é…ç°æœ‰ /api/
   B) Server Actions (Next.js 14 å†…ç½®)
   â†’ AI é€‰æ‹©: A

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¦ä¿®æ”¹è¯·åœ¨ä¸‹æ–¹ Type something ä¸­è¾“å…¥å¦‚ "Q3 æ¢ B"
```

### 5.2 AskUserQuestion é€‚é…

Claude Code çš„ AskUserQuestion æœ‰å›ºå®š UI å…ƒç´ ï¼Œæ–¹æ¡ˆå¡çš„ options å›ºå®šä¸º **3 ä¸ªé€‰é¡¹**:

```
UI æ˜¾ç¤ºæ•ˆæœ:
  1. å…¨éƒ¨æ¥å— (æ¨è)                  â† 80% ç”¨æˆ·ç›´æ¥é€‰
  2. æ–¹å‘ä¸å¯¹ï¼Œé‡æ–°ç”Ÿæˆ                â† é€ƒç”Ÿå£ï¼ŒAI é‡å‡ºæ–¹æ¡ˆå¡
  3. â†“ è¯·åœ¨ä¸‹æ–¹ Type something è¾“å…¥ä¿®æ”¹  â† å¼•å¯¼åˆ°æ•´å¡çº§ Other
  4. Type something                   â† ç”¨æˆ·è¾“å…¥ "Q3 æ¢ B"
```

**AskUserQuestion ç»“æ„**:
```json
{
  "questions": [{
    "question": "ã€æ–¹æ¡ˆå¡å†…å®¹ã€‘\n\nâ”â”â”â”â”â”\nè¦ä¿®æ”¹è¯·åœ¨ä¸‹æ–¹ Type something ä¸­è¾“å…¥å¦‚ \"Q3 æ¢ B\"",
    "header": "L2 é¢†åŸŸåˆ†æ”¯",
    "options": [
      { "label": "å…¨éƒ¨æ¥å— (æ¨è)", "description": "æŒ‰ AI æ¨èæ–¹æ¡ˆç»§ç»­" },
      { "label": "æ–¹å‘ä¸å¯¹ï¼Œé‡æ–°ç”Ÿæˆ", "description": "è¡¥å……è¯´æ˜å AI é‡æ–°å‡ºæ–¹æ¡ˆå¡" },
      { "label": "â†“ è¯·åœ¨ä¸‹æ–¹ Type something è¾“å…¥ä¿®æ”¹", "description": "å¦‚ 'Q3 æ¢ B'" }
    ],
    "multiSelect": false
  }]
}
```

### 5.3 ä¿®æ”¹æŒ‡ä»¤è§£æè§„åˆ™

| ç”¨æˆ·è¾“å…¥ | è§£æç»“æœ |
|---------|---------|
| `Q3 æ¢ B` | ç¬¬ 3 é¢˜æ”¹ä¸ºé€‰é¡¹ B |
| `Q2 æ¢ C, Q5 æ¢ B` | ç¬¬ 2 é¢˜æ”¹ä¸º Cï¼Œç¬¬ 5 é¢˜æ”¹ä¸º B |
| `ç¬¬ 3 ä¸ªé—®é¢˜æ¢æˆ B` | åŒ Q3 æ¢ B |
| `è®¤è¯æ–¹å¼æ¢æˆ Session` | æŒ‰å…³é”®è¯åŒ¹é…åˆ° Q3ï¼Œé€‰é¡¹åŒ¹é…åˆ° B |

**è§£æä¼˜å…ˆçº§**: ç²¾ç¡®æ ¼å¼ `QN æ¢ X` â†’ å…³é”®è¯åŒ¹é… â†’ æ— æ³•åŒ¹é…åˆ™è¿½é—®ä¸€æ¬¡ç¡®è®¤ã€‚

**å›æ˜¾ç¡®è®¤è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰**: ä¿®æ”¹æŒ‡ä»¤è§£æåï¼ŒAI å¿…é¡»å…ˆå›æ˜¾è§£æç»“æœï¼Œç­‰ç”¨æˆ·ç¡®è®¤åå†æ‰§è¡Œã€‚é¿å…è¯¯è§£æå¯¼è‡´çš„è¿é”é”™è¯¯ã€‚

**é€ƒç”Ÿå£å¤„ç†**: ç”¨æˆ·é€‰"æ–¹å‘ä¸å¯¹ï¼Œé‡æ–°ç”Ÿæˆ" â†’ AI è¿½é—® â†’ é‡æ–°ç”Ÿæˆæ–¹æ¡ˆå¡ï¼ˆæœ€å¤šé‡è¯• 2 æ¬¡ï¼Œä»ä¸æ»¡æ„ â†’ åˆ‡æ¢ä¸ºé€é¢˜æ¨¡å¼ï¼‰ã€‚

### 5.4 AI æ¨èé€‰æ‹©è§„åˆ™

**å¼ºåˆ¶è§„åˆ™ï¼šæ¯ä¸ª Q å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª AI æ¨èï¼Œæ— ä¾‹å¤–ã€‚**

| ä¼˜å…ˆçº§ | ä¾æ®æ¥æº | ç¤ºä¾‹ |
|--------|---------|------|
| 1 | ä»£ç åº“æ‰«æ | é¡¹ç›®ç”¨ Prisma â†’ æ¨è PostgreSQL + Prisma |
| 2 | L0 æ–¹å‘ + å‰åºå±‚çº§å›ç­” | ç”¨æˆ·é€‰"ç®¡ç†é¢æ¿" â†’ æ¨è DataTable |
| 3 | è¡Œä¸šæœ€ä½³å®è·µ | æ— ä»£ç åº“ â†’ æ¨èå½“å‰ä¸»æµæ–¹æ¡ˆ |
| 4 | æœ€å®‰å…¨/æœ€ç®€å• | æ— æ³•åˆ¤æ–­æ—¶ â†’ æ¨èæœ€ç¨³å¦¥é€‰é¡¹ |

### 5.5 å„å±‚æ–¹æ¡ˆå¡é€‚ç”¨èŒƒå›´

| å±‚çº§ | v2 å¤„ç†æ–¹å¼ | è¯´æ˜ |
|------|-----------|------|
| P0 æ¨¡å¼é€‰æ‹© | AskUserQuestion | 3 æ¨¡å¼é€‰æ‹© |
| **L0 æ–¹å‘æ¢ç´¢** | **markdown é¢„è§ˆ** | æˆ˜ç•¥å†³ç­–éœ€æ¶æ„é¢„è§ˆ |
| S1 ä»£ç æ‰«æ | è‡ªåŠ¨ (Explore Subagent) | é›¶äº¤äº’ |
| **R1 è§„èŒƒç¡®è®¤** | **AskUserQuestion** | æ‰«æ rules/ â†’ ç”¨æˆ·ç¡®è®¤ â†’ journal |
| **L1 æ ¸å¿ƒè¯†åˆ«** | **æ–¹æ¡ˆå¡** | 4-7 é¢˜åˆå¹¶ä¸º 1 å¡ |
| **L2 é¢†åŸŸåˆ†æ”¯** | **æ–¹æ¡ˆå¡** | 5-12 é¢˜åˆå¹¶ä¸º 1 å¡ï¼ˆå®Œæ•´è§„åˆ’ onlyï¼‰ |
| **L3 ç»†èŠ‚æ·±å…¥** | **æ–¹æ¡ˆå¡** | 5-12 é¢˜åˆå¹¶ä¸º 1 å¡ï¼ˆå®Œæ•´è§„åˆ’ onlyï¼‰ |
| **L4 è¾¹ç•Œç¡®è®¤** | **æ–¹æ¡ˆå¡** | 4-7 é¢˜åˆå¹¶ä¸º 1 å¡ |
| Phase 5.5 å¤–éƒ¨ä¾èµ– | è‡ªåŠ¨ | prerequisites â†’ journal |
| **L5 ç¡®è®¤é—¨æ§** | **ASCII Tab** | æœ€ç»ˆç¡®è®¤éœ€å¯è§†åŒ– |
| G1/W1 PRD ç”Ÿæˆ | è‡ªåŠ¨ (Subagent) | é›¶äº¤äº’ |
| A1 è‡ªåŠ¨å®¡æŸ¥ | è‡ªåŠ¨ (Skill) | Circuit Breaker é»˜è®¤ accept |
| A2 è‡ªåŠ¨è½¬æ¢ | è‡ªåŠ¨ (Skill) | é›¶äº¤äº’ï¼ŒChecklist FAIL â†’ æ‹’ç»ä¿å­˜ |

**Transformï¼ˆå¯¼å…¥æ¨¡å¼ï¼‰ï¼š**

| å±‚çº§ | v2 å¤„ç†æ–¹å¼ | è¯´æ˜ |
|------|-----------|------|
| P0 æ¨¡å¼é€‰æ‹© | AskUserQuestion | 3 æ¨¡å¼é€‰æ‹© |
| Ti æºæ–‡ä»¶è·å– | ä¸»å¯¹è¯ | éªŒè¯æº PRD + é¢„æ‰«æåŸºå‡† |
| S1 ä»£ç æ‰«æ | è‡ªåŠ¨ (Explore Subagent) | **ç»Ÿä¸€** â€” æ‰«æç›®æ ‡é¡¹ç›®ä»£ç åº“ |
| **R1 è§„èŒƒç¡®è®¤** | **AskUserQuestion** | **ç»Ÿä¸€** â€” æ‰«æ rules/ â†’ ç”¨æˆ·ç¡®è®¤ â†’ journal |
| Ta ç»“æ„å‘ç° | Explore Subagent | æºç« èŠ‚æ˜ å°„åˆ° Â§1-Â§8 |
| Tv å®Œæ•´æ€§æ ¡éªŒ | ä¸»å¯¹è¯ | å¤§æ–‡ä»¶å¿…æ‰§è¡Œ |
| **Tq è¡¥å……é—®ç­”** | **æ–¹æ¡ˆå¡** | ä»… PARTIAL/SPARSE ç»´åº¦ |
| Tg DT åˆ†è§£ | ä¸»å¯¹è¯ | Phaseâ†’DTï¼Œå‚è€ƒ S1 ä»£ç æ‰«æç»“æœ |
| Phase 5.5 å¤–éƒ¨ä¾èµ– | è‡ªåŠ¨ | **ç»Ÿä¸€** â€” prerequisites â†’ journal |
| **L5 ç¡®è®¤é—¨æ§** | **ASCII Tab** | **ç»Ÿä¸€** â€” T6 æ”¶æ•› |
| G1/W1 PRD ç”Ÿæˆ | è‡ªåŠ¨ (Subagent) | å……åˆ†æ‘˜å½•åŸåˆ™ |
| **Tf å®Œæ•´æ€§é—¨æ§** | **Subagent** | **Transform ç‰¹æœ‰ï¼Œå¤§æ–‡ä»¶å¿…æ‰§è¡Œï¼›æœ€ç»ˆè´¨æ§å…³å¡ï¼ˆå®Œæ•´æ€§æ¯”å¯¹+è‡ªåŠ¨è¡¥å……ï¼‰ï¼ŒA1/A2 å‰å”¯ä¸€ä¿® prd.md çš„æœºä¼š** |
| A1 è‡ªåŠ¨å®¡æŸ¥ | è‡ªåŠ¨ (Skill("prdreview")) | **ç»Ÿä¸€** |
| A2 è‡ªåŠ¨è½¬æ¢ | è‡ªåŠ¨ (Skill("prd2json")) | **ç»Ÿä¸€** |

**Transform Tq è¡¥å……æ–¹æ¡ˆå¡ç¤ºä¾‹**ï¼ˆè¦†ç›–ä¸è¶³ç»´åº¦ï¼‰:

```
ã€Transform Tq â€” AI è¡¥å……æ–¹æ¡ˆå¡ã€‘

è¦†ç›–ä¸è¶³ç»´åº¦: Â§5 UI (PARTIAL), Â§6 è§„åˆ™ (SPARSE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â§5 è¡¥å……:
  Q1. é¡µé¢æ•°: A) 2ä¸ª â† æ¨æ–­  B) 3ä¸ª  C) æˆ‘æ¥åˆ—
  â†’ AI é€‰æ‹©: A

Â§6 è¡¥å……:
  Q2. åˆ é™¤ç­–ç•¥: A) è½¯åˆ é™¤ â† å®‰å…¨  B) ç¡¬åˆ é™¤+ç¡®è®¤
  â†’ AI é€‰æ‹©: A
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¦ä¿®æ”¹è¯·åœ¨ä¸‹æ–¹ Type something ä¸­è¾“å…¥å¦‚ "Q2 æ¢ B"
```

### 5.6 é—®é¢˜åˆ†ç±»ï¼šä¸šåŠ¡é¢˜ vs æŠ€æœ¯é¢˜

| åˆ†ç±» | ç‰¹å¾ | æ–¹æ¡ˆå¡è¡¨ç° |
|------|------|-----------|
| **ä¸šåŠ¡é¢˜** | ç›®æ ‡ç”¨æˆ·ã€æ ¸å¿ƒä»·å€¼ã€èŒƒå›´ã€ä¸šåŠ¡è§„åˆ™ | é€‰é¡¹ç”¨ä¸šåŠ¡è¯­è¨€ï¼Œæ¨èåŸºäºç”¨æˆ·éœ€æ±‚ |
| **æŠ€æœ¯é¢˜** | API ç±»å‹ã€æ•°æ®åº“ã€æ¡†æ¶ã€è®¤è¯ | é€‰é¡¹å«æŠ€æœ¯åè¯ï¼Œæ¨èç†ç”±ç”¨ç™½è¯ `â† åŒ¹é…ä½ ç°æœ‰é¡¹ç›®` |

## 6. ä¸šåŠ¡è§„åˆ™

### 6.1 ä¸»æƒä¸ç®¡çº¿è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-001 | prd.md ä¿ç•™å®Œæ•´ Â§1-Â§8 å« Â§7 | Â§7 ä¸å‰¥ç¦»ï¼Œä½œä¸ºäººç±»å¯è¯»è®¡åˆ’å’Œå®¹ç¾å¤‡ä»½ | ALL |
| BR-002 | **prd.md å†™å…¥æƒé™åˆ†çº§** | PyramidPRD ä¸»å†™ + PRDReview å—æ§è¦†ç›–ï¼›PRD2JSON åªè¯» | DT-006, DT-016 |
| BR-010 | è§„èŒƒèåˆç›®æ ‡ä¸º dev.json AC | ç›´æ¥ç”Ÿæˆåˆ° AC[]ï¼Œä¸ä¿®æ”¹ prd.md | DT-006 |
| BR-026 | **PRDing Ralph æ¨¡å‹** | Tf åå¯åŠ¨ Background Agent ç¼–æ’å™¨æ‰§è¡Œ A1+A2ï¼›ç‹¬ç«‹ context ~245KB | DT-001, DT-016 |
| BR-027 | **R1 è§„èŒƒç¡®è®¤å‰ç½®ï¼ˆå…¨æ¨¡å¼å…±äº«ï¼‰** | è§„èŒƒæ‰«æ+ç¡®è®¤ä» PRD2JSON ç§»è‡³ PyramidPRD R1 é˜¶æ®µ | DT-002, DT-006 |
| BR-028 | **PRD2JSON é›¶äº¤äº’** | R1 ç»“æœä» journal è¯»å–ï¼›ä¸åšæºæ–‡ä»¶æ¯”å¯¹ | DT-006, DT-008 |
| BR-029 | **PRDReview auto-chain é»˜è®¤è¡Œä¸º** | Circuit Breaker é»˜è®¤ accept + advisoryï¼ˆä¸é˜»å¡ç®¡çº¿ï¼‰ | DT-016 |
| BR-041 | **ç®¡çº¿å¹¶å‘ä¿æŠ¤** | Ralph åå°æ‰§è¡ŒæœŸé—´ï¼Œæ‰‹åŠ¨ /prd2json åº”æ£€æŸ¥ pipeline.lockï¼›Stale lock æ¸…ç†: PID ä¸å­˜åœ¨æˆ– TTL > 30min æ—¶è‡ªåŠ¨æ¸…é™¤ | DT-001 |

### 6.2 æ•°æ®æ ¼å¼è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-003 | dev.json æ¯ä¸ª DT å¿…æœ‰ description + AC[] | â‰¥ 2 å¥è¯æè¿° + â‰¥ 3 æ¡ AC | DT-005 |
| BR-004 | designRefs æ›¿ä»£ prdSection | "Â§X.Y æ ‡é¢˜å…³é”®è¯" æŠ—æ¼‚ç§» | DT-005 |
| BR-005 | æ—§é¡¹ç›®ä¸åšå…¼å®¹ | æ—§ prd.json å½’æ¡£ | DT-008 |
| BR-009 | registry.json æ–°å¢ devJson | ä¿ç•™ prdMdï¼Œå»æ‰ prdJson | DT-009 |
| BR-011 | testCases æ‹¦æˆªé—¨ | ç©º testCases â†’ æ‹’ç»ä¿å­˜ | DT-007 |
| BR-012 | e2e å¿…å« playwrightMcp | steps 3-8ï¼Œurl ç›¸å¯¹è·¯å¾„ | DT-007 |
| BR-013 | åŒå†™ç­–ç•¥ | tasks/<id>/ + æ ¹ç›®å½• | DT-008 |
| BR-014 | æ—§ç‰¹å¾å½’æ¡£ | branchName ä¸åŒ â†’ archive/ | DT-008 |
| BR-015 | 18 é¡¹ Checklist å…¨é€šè¿‡ | ä»»ä¸€å¤±è´¥ â†’ æ‹’ç»ä¿å­˜ | DT-008, DT-017 |
| BR-018 | **A2 Checklist 18 é¡¹** | åŸ 17 é¡¹ + prd-dev-consistency | DT-008, DT-017 |
| BR-031 | **18 é¡¹ Checklist** | åŸ 15 + field-completeness + designRef-validity + prd-dev-consistency | DT-008, DT-017 |
| BR-034 | **A2 Checklist ç¬¬ 18 é¡¹** | prd-dev-consistency: prd.md Â§7 vs dev.json DT æ•°é‡/Phase ç»“æ„ | DT-008, DT-017 |

### 6.3 æ‰§è¡Œå¼•æ“è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-019 | Journal æ¯å±‚å¿…å†™ | æ¯ä¸ª L å±‚ç»“æŸå†™å…¥ qa-journal.md | DT-018 |
| BR-035 | **Journal çº¯ Markdown æ ¼å¼** | å›ºå®šæ ‡é¢˜é”šç‚¹ï¼ˆ`## R1 è§„èŒƒç¡®è®¤`ï¼‰ï¼›Grep+Read å®šä½ | DT-018 |
| BR-020 | å¤§æ–‡ä»¶é˜ˆå€¼ | > 5000 è¡Œ C1ï¼Œ2000-5000 C2ï¼Œ< 2000 å½“å‰æµç¨‹ | DT-023 |
| BR-036 | **å¤§æ–‡ä»¶å¹¶è¡Œ Subagent â‰¤ 4** | > 4 ä¸ª Phase Bundle æ—¶åˆ†æ‰¹æ‰§è¡Œ | DT-023 |

### 6.4 æ–¹æ¡ˆå¡è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-021 | **æ–¹æ¡ˆå¡æ¯é¢˜å¿…æœ‰ AI æ¨è** | æ¨èä¼˜å…ˆçº§: ä»£ç æ‰«æ > å‰åºç­”æ¡ˆ > æœ€ä½³å®è·µ > æœ€å®‰å…¨ | DT-021 |
| BR-022 | **æ–¹æ¡ˆå¡ä¿®æ”¹æŒ‡ä»¤è§£æ** | æ”¯æŒ "QN æ¢ X" / å…³é”®è¯åŒ¹é… / è‡ªç”±æ–‡æœ¬ | DT-021 |
| BR-023 | **L0/L5 ä¸ç”¨æ–¹æ¡ˆå¡** | L0 éœ€ markdown æ¶æ„é¢„è§ˆï¼ŒL5 éœ€ ASCII Tab | DT-021 |
| BR-024 | **æ–¹æ¡ˆå¡å«é€ƒç”Ÿå£** | "æ–¹å‘ä¸å¯¹ï¼Œé‡æ–°ç”Ÿæˆ" é€‰é¡¹ï¼Œæœ€å¤šé‡è¯• 2 æ¬¡ååˆ‡é€é¢˜æ¨¡å¼ | DT-021 |
| BR-025 | **ä¿®æ”¹æŒ‡ä»¤å›æ˜¾ç¡®è®¤** | è§£æåå¿…é¡»å›æ˜¾ç»“æœç­‰ç”¨æˆ·ç¡®è®¤ | DT-021 |
| BR-037 | **æ–¹æ¡ˆå¡æ¯é¢˜ 2-4 é€‰é¡¹** | > 4 é€‰é¡¹ â†’ æ‹†åˆ†é—®é¢˜ï¼›æ•´å¡çº§ Type something å¤„ç†è‡ªç”±è¾“å…¥ | DT-021 |

### 6.5 æ¨¡å¼ä¸ Transform è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-006 | ~~Quick Fix ä¹Ÿèµ° auto-chain~~ **å·²åˆ é™¤** | å¿«é€Ÿä¿®å¤æ¨¡å¼å·²åˆ é™¤ | â€” |
| BR-007 | T7 å­—æ®µçº§ + SQL æ ¡éªŒ | DTâ†”prd.md äº¤å‰æ£€æŸ¥ | DT-003 |
| BR-008 | Transform T1 åˆ›å»º prd_original.md | åªè¯»å¤‡ä»½ï¼ŒT7 åŸºå‡† | DT-003 |
| BR-016 | å®Œæ•´æ€§æ¯”å¯¹ï¼ˆTf æ‰§è¡Œï¼‰ | FAIL â†’ è‡ªåŠ¨è¡¥å…… prd.md | DT-003 |
| BR-030 | **æ¨¡å¼ç²¾ç®€ 4â†’3** | åˆ é™¤å¿«é€Ÿä¿®å¤æ¨¡å¼ | DT-002 |
| BR-032 | **S1 ä»£ç æ‰«æå…¨æ¨¡å¼å…±äº«** | Transform ä¹Ÿæ‰§è¡Œ S1 | DT-002, DT-019 |
| BR-033 | **Phase 5.5 å¤–éƒ¨ä¾èµ–å…¨æ¨¡å¼å…±äº«** | Transform ä¹Ÿæ‰§è¡Œ Phase 5.5 | DT-002 |

### 6.6 å®‰å…¨è§„åˆ™

| ID | è§„åˆ™ | è¯´æ˜ | å½±å“ DT |
|----|------|------|---------|
| BR-038 | **eval å‘½ä»¤å®‰å…¨çº¦æŸ** | é™åˆ¶ä¸ºå·²çŸ¥å®‰å…¨æ¨¡æ¿ï¼ˆ`npx tsc --noEmit`ã€`npm test` ç­‰ï¼‰ï¼›æ‹’ç»ç®¡é“ç¬¦ã€é“¾å¼æ‰§è¡Œã€é‡å®šå‘ç­‰ shell å…ƒå­—ç¬¦ | DT-008 |
| BR-039 | **Transform æºè·¯å¾„å®‰å…¨æ ¡éªŒ** | SOURCE_PRD.ref è·¯å¾„å¿…é¡»ç» realpath å½’ä¸€åŒ–ï¼›æ‹’ç» `..` æˆ–ç¬¦å·é“¾æ¥é€ƒé€¸ | DT-003 |
| BR-040 | **Codex auto-chain æ²™ç®±è¾¹ç•Œ** | Codex `exec --full-auto` è¿è¡Œåœ¨å†…ç½®æ²™ç®±ï¼›auto-chain ä¸­ prd.md è¦†ç›–ä»…é™ `tasks/<id>/prd.md` | DT-016 |
| BR-042 | **PRDReview Standalone æ¨¡å¼** | å‚æ•°ä¸ºæ–‡ä»¶è·¯å¾„æ—¶è¿›å…¥ standaloneï¼›å¤‡ä»½ `{stem}_original.md` â†’ è¦†ç›– â†’ `{stem}_review.json` | DT-016 |
| BR-017 | PRDReview ç»Ÿä¸€è¦†ç›–ç­–ç•¥ | A1: è‡ªåŠ¨è¦†ç›– + prd-review-fixed.mdï¼›Standalone: å¤‡ä»½åè¦†ç›– + `_review.json` | DT-016 |

### 6.7 å†³ç­–æ ‘

```
PRD ç¼–å†™å®Œæˆ
â”œâ”€â”€ ç”¨æˆ·ç¡®è®¤ PRD?
â”‚   â”œâ”€â”€ æ˜¯ â†’ Tf å®Œæ•´æ€§é—¨æ§
â”‚   â”‚   â”œâ”€â”€ PASS â†’ å¯åŠ¨ Ralph [A1â†’A2]
â”‚   â”‚   â”‚   â”œâ”€â”€ A1 æˆåŠŸ â†’ A2 å¯åŠ¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ A2 Checklist å…¨é€šè¿‡ â†’ é€šçŸ¥"PRD å®¡æŸ¥+è½¬æ¢å®Œæˆ"
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ A2 Checklist FAIL â†’ æ‹’ç»ä¿å­˜ + é€šçŸ¥ç”¨æˆ·
â”‚   â”‚   â”‚   â””â”€â”€ A1 Circuit Breaker â†’ accept + advisory â†’ A2 ç»§ç»­
â”‚   â”‚   â””â”€â”€ FAIL â†’ è‡ªåŠ¨è¡¥å…… prd.md (max 2 è½®)
â”‚   â””â”€â”€ å¦ â†’ è¿”å›ä¿®æ”¹
â””â”€â”€ Ralph ç¼–æ’å™¨å¤±è´¥ â†’ æ‰“å°æ¢å¤æŒ‡ä»¤: "è¯·è¿è¡Œ /prdreview ç„¶å /prd2json"
```

## 7. å¼€å‘è®¡åˆ’

### 7.0 Phase ä¾èµ–å›¾

```
Stream 1: è¾“å‡ºæ ¼å¼ + ç®¡çº¿ä¸»æƒ             Stream 2: æ‰§è¡Œå¼•æ“ + é—®ç­”åŠ é€Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Phase 1 â”€â”€â–¶ Phase 2 â”€â”€â–¶ Phase 3         Phase 4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Phase 5
PyramidPRD   PRD2JSON    æ¶ˆè´¹æ–¹é€‚é…       Q&A Journal         å¤§æ–‡ä»¶
auto-chain   fat dev.json (å«PRDReview)  + Subagent          Transform
+ R1 è§„èŒƒå‰ç½®  é›¶äº¤äº’åŒ–    + A1/A2 è¡Œä¸º   + æ–¹æ¡ˆå¡ (P1)       (P2)
(P0)         (P0)        (P0)
                               \          /
                                â–¼        â–¼
                               Phase 6
                               ç«¯åˆ°ç«¯éªŒè¯
                               (P1)

Stream 1 å’Œ Stream 2 å¯å¹¶è¡Œæ¨è¿›ï¼ˆä¸äº’ç›¸ä¾èµ–ï¼‰
Phase 6 ä¾èµ– Stream 1 Phase 1-3 + Stream 2 Phase 4ï¼ˆè‡³å°‘ Journalï¼‰
```

### 7.1 Phase 1: PyramidPRD auto-chain + R1 è§„èŒƒå‰ç½®ï¼ˆP0, 4 DTï¼‰

> **å‰ç½®**: æ— 
> **äº§å‡º**: ä¸‰æ­¥è‡ªåŠ¨ç®¡çº¿ + R1 è§„èŒƒç¡®è®¤ + åˆ é™¤å¿«é€Ÿä¿®å¤æ¨¡å¼ + Transform Tf å­—æ®µçº§æ ¡éªŒ
> **æ”¹åŠ¨æ–‡ä»¶**: `skills/BotoolAgent/PyramidPRD/SKILL.md`
> **å¯¹åº”è®¾è®¡**: Section 3.2 ADR-3/ADR-10, 3.4, 4.7

- [ ] DT-001: Tf åæ·»åŠ  PRDing Ralph æŒ‡ä»¤ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - Tf å®Œæˆå Task(run_in_background) â†’ ç¼–æ’å™¨ [Skill("prdreview") â†’ Skill("prd2json")]
  - **åˆ é™¤**ç›´æ¥å†™ prd.json çš„é€»è¾‘ï¼ˆ~L1002ï¼‰
  - **åˆ é™¤**ç›´æ¥æ›´æ–° registry çš„é€»è¾‘ï¼ˆ~L1003ï¼‰
  - æ–°å¢ pipeline.lock åˆ›å»º/æ¸…ç†é€»è¾‘
- [ ] DT-002: R1 è§„èŒƒç¡®è®¤ + S1/Phase 5.5 å…¨æ¨¡å¼ç»Ÿä¸€ + åˆ é™¤å¿«é€Ÿä¿®å¤ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - S1 åæ–°å¢ R1ï¼ˆå…¨æ¨¡å¼å…±äº«ï¼Œå« Transformï¼‰
  - Transform æ–°å¢ S1 ä»£ç æ‰«æ + Phase 5.5 å¤–éƒ¨ä¾èµ–
  - P0 ä» 4â†’3 æ¨¡å¼
  - åˆ é™¤ Quick Fix å…¨éƒ¨é€»è¾‘
- [ ] DT-003: Transform Ti å¤‡ä»½ + Tf å­—æ®µçº§æ ¡éªŒ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - Ti cp â†’ prd_original.md
  - Tf DTâ†”prd.md äº¤å‰æ£€æŸ¥ + SQL å­—æ®µå®Œæ•´æ€§
  - SOURCE_PRD.ref è·¯å¾„å®‰å…¨æ ¡éªŒï¼ˆrealpath å½’ä¸€åŒ–ï¼‰
- [ ] DT-004: Transform Tv å­—æ®µæ•°æ ¡éªŒ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - æ¯è¯»å®Œ CREATE TABLE è®°å½•å­—æ®µæ•°
  - Tv å¯¹æ¯”å­—æ®µæ•°å·®å¼‚

### 7.2 Phase 2: PRD2JSON é‡æ„ï¼ˆP0, 6 DTï¼‰

> **å‰ç½®**: Phase 1
> **äº§å‡º**: PRD2JSON å˜ä¸º fat dev.json ç”Ÿæˆå™¨ï¼ˆprd.md åªè¯» + é›¶ç”¨æˆ·äº¤äº’ï¼‰
> **æ”¹åŠ¨æ–‡ä»¶**: `skills/BotoolAgent/PRD2JSON/SKILL.md`
> **å¯¹åº”è®¾è®¡**: Section 4.1-4.6

- [ ] DT-005: è¾“å‡ºä» slim prd.json â†’ fat dev.json (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - Schema å˜æ›´ï¼šç§»é™¤ prdSection â†’ æ–°å¢ description(å¿…å¡«), AC[](å¿…å¡«), designRefs[](å¿…å¡«), files[](å¯é€‰)
  - åˆ é™¤ constitutionFusedAt/knownGaps
  - [å®‰å…¨] eval å‘½ä»¤é™åˆ¶ä¸ºå·²çŸ¥å®‰å…¨æ¨¡æ¿
- [ ] DT-006: è§„èŒƒèåˆå…¨è‡ªåŠ¨åŒ– (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - ä» qa-journal.md è¯»å– R1 è§„èŒƒç¡®è®¤ç»“æœï¼ˆæ—  journal â†’ è‡ªåŠ¨ä¿ç•™å…¨éƒ¨ï¼‰
  - [è§„èŒƒ] æ¡ç›®ç›´æ¥ç”Ÿæˆåˆ° dev.json AC[]
  - **åˆ é™¤** Step 3 ä¿®æ”¹ prd.md çš„å…¨éƒ¨é€»è¾‘
  - **åˆ é™¤**ç”¨æˆ·ç¡®è®¤ AskUserQuestion
- [ ] DT-007: testCases/evals/steps/playwrightMcp/sessions ä¿ç•™ (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - éªŒè¯ç°æœ‰é€»è¾‘åœ¨ dev.json æ ¼å¼ä¸‹æ­£å¸¸å·¥ä½œ
  - testCases ç”Ÿæˆé€šè¿‡ designRefs æ›¿ä»£ prdSection è¯»å– PRD å†…å®¹
- [ ] DT-008: åŒå†™ + Archiving + Checklist (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - prd.json â†’ dev.json åŒå†™ï¼ˆtasks/<id>/ + æ ¹ç›®å½•ï¼‰
  - Archiving æ£€æŸ¥æ—§ prd.json å’Œ dev.json
  - 18 é¡¹ Checklistï¼ˆå« prd-dev-consistencyï¼‰
  - [å®‰å…¨] eval å‘½ä»¤å®‰å…¨æ ¡éªŒï¼ˆChecklist é¡¹ 8ï¼‰
- [ ] DT-009: registry.json å­—æ®µæ›´æ–° (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - æ–°å¢ devJson å­—æ®µ
  - ç§»é™¤ prdJson
  - ä¿ç•™ prdMd
- [ ] DT-010: Viewer Mode æ–‡å­—æ›´æ–° (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - æç¤ºæ–‡å­— prd.json â†’ dev.json
  - Viewer æ¨¡å¼æ£€æµ‹ + dev server å¯åŠ¨é€»è¾‘ä¿ç•™

### 7.3 Phase 3: æ¶ˆè´¹æ–¹é€‚é…ï¼ˆP0, 7 DTï¼‰

> **å‰ç½®**: Phase 2
> **äº§å‡º**: å®Œæ•´ CLI é“¾è·¯è¯»å– dev.json + PRDReview åŒæ¨¡å¼ + A2 Checklist 18 é¡¹
> **æ”¹åŠ¨æ–‡ä»¶**: CLAUDE.lead.md, Testing SKILL, Coding SKILL, Finalize SKILL, BotoolAgent.sh, PRDReview SKILL
> **å¯¹åº”è®¾è®¡**: Section 3.3, 3.4

- [ ] DT-011: CLAUDE.lead.md â€” fat-only æ¨¡å¼ (`æ–‡ä»¶: CLAUDE.lead.md`)
  - åˆ  slim æ¨¡å¼ + prdSection
  - dev.json ä¸ºå”¯ä¸€è·¯å¾„
  - æ–°å¢ designRefs è¯»å–é€»è¾‘
- [ ] DT-012: Testing SKILL â€” dev.json è·¯å¾„ (`æ–‡ä»¶: skills/BotoolAgent/Testing/SKILL.md`)
  - PRD_PATH â†’ dev.json
  - åˆ  prd.json fallback
- [ ] DT-013: Coding SKILL â€” dev.json è·¯å¾„ (`æ–‡ä»¶: skills/BotoolAgent/Coding/SKILL.md`)
  - å…¨å±€æ›¿æ¢ prd.json â†’ dev.json
- [ ] DT-014: Finalize SKILL â€” dev.json è·¯å¾„ (`æ–‡ä»¶: skills/BotoolAgent/Finalize/SKILL.md`)
  - å…¨å±€æ›¿æ¢ prd.json â†’ dev.json
- [ ] DT-015: BotoolAgent.sh â€” è·¯å¾„æ›´æ–° (`æ–‡ä»¶: scripts/BotoolAgent.sh`)
  - basename "prd.json" â†’ "dev.json"
  - PRD_FILE æŒ‡å‘ dev.jsonï¼ˆ6 å¤„ç¡¬ç¼–ç ï¼‰
- [ ] DT-016: PRDReview â€” åŒæ¨¡å¼ï¼ˆA1 è‡ªåŠ¨ + Standaloneï¼‰ (`æ–‡ä»¶: skills/BotoolAgent/PRDReview/SKILL.md`)
  - auto-chain: Circuit Breaker é»˜è®¤ accept + advisory
  - **Standalone**: å‚æ•°ä¸ºæ–‡ä»¶è·¯å¾„æ—¶è·³è¿‡ registry æŸ¥æ‰¾
    - å¤‡ä»½ `{stem}_original.md` â†’ è¦†ç›–åŸæ–‡ä»¶ â†’ `{stem}_review.json`
  - å…±ç”¨: Codex æ•Œå¯¹å¾ªç¯ / é™çº§æ¨¡å¼ / fail-closed
  - **åˆ é™¤**ç‹¬ç«‹é¡¹ç›®å®¡æŸ¥æ¨¡å¼
  - [å®‰å…¨] Codex æ²™ç®±è¾¹ç•Œï¼šauto-chain ä»…é™ `tasks/<id>/prd.md`
- [ ] DT-017: A2 Checklist æ‰©å±• 17â†’18 é¡¹ (`æ–‡ä»¶: skills/BotoolAgent/PRD2JSON/SKILL.md`)
  - æ–°å¢ prd-dev-consistency ç»´åº¦
  - prd.md Â§7 vs dev.json DT æ•°é‡/Phase ç»“æ„ä¸€è‡´æ€§æ ¡éªŒ

### 7.4 Phase 4: æ‰§è¡Œå¼•æ“ + é—®ç­”åŠ é€Ÿï¼ˆP1, 5 DTï¼‰

> **å‰ç½®**: æ— ï¼ˆå¯ä¸ Stream 1 å¹¶è¡Œï¼‰
> **äº§å‡º**: PyramidPRD ä¸Šä¸‹æ–‡å¯æ§ + compact å®‰å…¨ + äº¤äº’æ¬¡æ•°å¤§å¹…é™ä½
> **æ”¹åŠ¨æ–‡ä»¶**: `skills/BotoolAgent/PyramidPRD/SKILL.md`
> **å¯¹åº”è®¾è®¡**: Section 3.5, 4.4, 5.1-5.6

- [ ] DT-018: Q&A Journal æŒä¹…åŒ– (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - æ¯å±‚ç»“æŸ Write journal â†’ ä¸‹å±‚å¼€å§‹ Read journal
  - æ ¼å¼å®šä¹‰ï¼ˆå« R1 è§„èŒƒç¡®è®¤è®°å½• + æ–¹æ¡ˆå¡é€‰æ‹©è®°å½•ï¼‰
- [ ] DT-019: ä»£ç æ‰«æ â†’ Explore Subagentï¼ˆå…¨æ¨¡å¼å…±äº«ï¼‰ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - S1 æ”¹ä¸º Task(Explore) è°ƒç”¨ï¼ˆä¸‰æ¨¡å¼ç»Ÿä¸€ï¼Œå« Transformï¼‰
  - è¾“å‡º codebase-scan.md
  - Transform ä¸­ Tg DT åˆ†è§£å‚è€ƒ S1 ç»“æœ
- [ ] DT-020: PRD ç”Ÿæˆ â†’ general-purpose Subagent (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - G1/W1 æ”¹ä¸º Task(general-purpose) è°ƒç”¨
  - è¾“å…¥ journal + scan
- [ ] DT-021: L1-L4 æ–¹æ¡ˆå¡æ‰¹é‡ç¡®è®¤ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - æ¯å±‚é€é¢˜ AskUserQuestion â†’ 1 ä¸ªæ–¹æ¡ˆå¡
  - å¼ºåˆ¶ AI æ¨èï¼ˆæ¯é¢˜ 2-4 é€‰é¡¹ + æ•´å¡çº§é€ƒç”Ÿå£ï¼‰
  - ä¿®æ”¹æŒ‡ä»¤è§£æï¼ˆ"QN æ¢ X"ï¼‰+ å›æ˜¾ç¡®è®¤
- [ ] DT-022: Transform Tq è¡¥å……æ–¹æ¡ˆå¡ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - Tq é’ˆå¯¹æ€§é—®ç­”æ”¹ä¸ºæ–¹æ¡ˆå¡æ ¼å¼ï¼ˆä»… PARTIAL/SPARSE ç»´åº¦ï¼‰

### 7.5 Phase 5: å¤§æ–‡ä»¶ Transform æ¶æ„ï¼ˆP2, 4 DTï¼‰

> **å‰ç½®**: Phase 4ï¼ˆQ&A Journal + Subagent åŸºç¡€ï¼‰
> **äº§å‡º**: > 5000 è¡Œ PRD å¯é å¤„ç†
> **æ”¹åŠ¨æ–‡ä»¶**: `skills/BotoolAgent/PyramidPRD/SKILL.md`
> **å¯¹åº”è®¾è®¡**: Section 3.6

- [ ] DT-023: å¤§æ–‡ä»¶æ£€æµ‹ + é˜ˆå€¼è·¯ç”± (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - æº PRD è¡Œæ•°æ£€æµ‹
  - < 2000 / 2000-5000 / > 5000 åˆ†æµè·¯ç”±
- [ ] DT-024: C2 å•æºå¤šéæŠ½å– (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - 4 ä¸ª Explore subagent æŒ‰ç»´åº¦æå–
  - ä¸»å¯¹è¯åˆå¹¶
- [ ] DT-025: C1 Master Context æå– (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - Explore subagent â†’ master-context.md
- [ ] DT-026: C1 Phase Bundle åˆ†åŒ… + å¹¶è¡Œå¤„ç† + åˆå¹¶ (`æ–‡ä»¶: skills/BotoolAgent/PyramidPRD/SKILL.md`)
  - æŒ‰ Phase åˆ›å»ºåˆ†åŒ…ï¼ˆâ‰¤ 4 å¹¶è¡Œ Subagentï¼‰
  - å¹¶è¡Œå¤„ç† + åˆå¹¶æ ¡éªŒ

### 7.6 Phase 6: ç«¯åˆ°ç«¯éªŒè¯ï¼ˆP1, 1 DTï¼‰

> **å‰ç½®**: Phase 1-3 + Phase 4ï¼ˆè‡³å°‘ Journal + æ–¹æ¡ˆå¡ï¼‰
> **äº§å‡º**: botool-present-v16 éªŒè¯é€šè¿‡
> **å¯¹åº”è®¾è®¡**: Section 1.3

- [ ] DT-027: é‡æ–°è½¬æ¢ botool-present-v16
  - éªŒè¯: CREATE TABLE å­—æ®µ â‰¥ 95%
  - éªŒè¯: è§„åˆ™è¦†ç›– â‰¥ 40%
  - éªŒè¯: dev.json fat å®Œæ•´
  - éªŒè¯: T7 æ— å‡é˜³æ€§
  - éªŒè¯: BotoolAgent.sh å¯åŠ¨æ­£ç¡®
  - éªŒè¯: A2 Checklist 18 é¡¹é€šè¿‡ï¼ˆå« prd-dev-consistencyï¼‰
  - éªŒè¯: æ–¹æ¡ˆå¡äº¤äº’ â‰¤ 10 æ¬¡
  - éªŒè¯: Ralph è‡ªåŠ¨ç®¡çº¿ç«¯åˆ°ç«¯é€šè¿‡

### DT ç»Ÿè®¡

| Phase | DT æ•° | ä¼˜å…ˆçº§ | Stream |
|-------|-------|--------|--------|
| Phase 1: PyramidPRD auto-chain + R1 | 4 | P0 | è¾“å‡ºæ ¼å¼ |
| Phase 2: PRD2JSON é‡æ„ | 6 | P0 | è¾“å‡ºæ ¼å¼ |
| Phase 3: æ¶ˆè´¹æ–¹é€‚é… | 7 | P0 | è¾“å‡ºæ ¼å¼ + ç®¡çº¿ä¸»æƒ |
| Phase 4: æ‰§è¡Œå¼•æ“ + é—®ç­”åŠ é€Ÿ | 5 | P1 | æ‰§è¡Œå¼•æ“ |
| Phase 5: å¤§æ–‡ä»¶ Transform | 4 | P2 | æ‰§è¡Œå¼•æ“ |
| Phase 6: ç«¯åˆ°ç«¯éªŒè¯ | 1 | P1 | éªŒè¯ |
| **åˆè®¡** | **27** | | |

## 8. é™„å½•

### A0. v1â†’v2 å…³é”®å˜åŒ–æ±‡æ€»

| # | å˜åŒ– | æ•ˆæœ |
|---|------|------|
| 1 | prd.md å†™å…¥æƒé™åˆ†çº§ï¼ˆPyramidPRD ä¸»å†™ + PRDReview å—æ§å†™ï¼‰ | ä»ä¸‰æ–¹éšæ„å†™æ”¶ç´§ä¸ºä¸¤æ–¹åˆ†çº§å†™ |
| 2 | PRD2JSON åªè¯»æ¶ˆè´¹ prd.md | æ¶ˆé™¤ [è¦ç¯„] æ³¨å…¥å‰¯ä½œç”¨ |
| 3 | PRDReview å‰ç½®äº PRD2JSONï¼ˆA1 â†’ A2ï¼‰ | dev.json åŸºäºæœ€ä¼˜ prd.md ç”Ÿæˆï¼Œæ— éœ€é‡è·‘ |
| 4 | dev.json æ›¿ä»£ prd.json (fat) | æ¶ˆé™¤ skip-read è„†å¼±æ€§ |
| 5 | designRefs æ›¿ä»£ prdSection | æŠ—è¡Œå·æ¼‚ç§» |
| 6 | ä¸‰æ­¥è‡ªåŠ¨ç®¡çº¿ | PyramidPRD â†’ A1 PRDReview â†’ A2 PRD2JSONï¼Œç”¨æˆ·ç¡®è®¤ PRD åå…¨è‡ªåŠ¨ |
| 7 | Q&A Journal + Subagent | ä¸Šä¸‹æ–‡ ~150KB â†’ ~50KB |
| 8 | æ–¹æ¡ˆå¡æ‰¹é‡ç¡®è®¤ | äº¤äº’ 23-44 æ¬¡ â†’ ~9 æ¬¡ |
| 9 | R1 è§„èŒƒç¡®è®¤å‰ç½® | ä» PRD2JSON ç§»åˆ° PyramidPRDï¼ŒPRD2JSON é›¶äº¤äº’ |
| 10 | æ¨¡å¼ç²¾ç®€ 4â†’3 | åˆ é™¤å¿«é€Ÿä¿®å¤æ¨¡å¼ï¼ˆå®Œæ•´è§„åˆ’ / åŠŸèƒ½å¼€å‘ / Transformï¼‰ |
| 11 | A2 Checklist 17â†’18 é¡¹ | åŸ 15 + field-completeness + designRef-validity + prd-dev-consistency |
| 12 | ä¸‰æ¨¡å¼ç»Ÿä¸€å…±äº«é˜¶æ®µ | S1+R1+Phase 5.5+L5+A1+A2 å…¨æ¨¡å¼å…±äº«ï¼ŒTransform è¡¥é½ GAP |
| 13 | å®Œæ•´æ€§æ¯”å¯¹ç§»è‡³ PyramidPRD Tf | PRD2JSON ä¸å†åšæºæ–‡ä»¶æ¯”å¯¹ï¼›Tf åœ¨ PRD ç”Ÿæˆåç«‹å³æ‰§è¡Œï¼ŒFAIL â†’ è‡ªåŠ¨è¡¥å…… prd.md |
| 14 | PRDing Ralph æ¨¡å‹ | A1+A2 ç”± Background Agent ç¼–æ’å™¨æ‰§è¡Œï¼›context éš”ç¦»ï¼ˆ~50KB vs ~245KBï¼‰ï¼›ä¸ Coding/Testing Ralph ä¸€è‡´ |
| 15 | PRDReview ç²¾ç®€ä¸ºåŒæ¨¡å¼ï¼ˆA1 è‡ªåŠ¨ + Standaloneï¼‰ | åˆ é™¤ç‹¬ç«‹é¡¹ç›®å®¡æŸ¥æ¨¡å¼ï¼›æ–°å¢ Standalone ä»»æ„ .md å®¡æŸ¥ï¼Œå¤‡ä»½ `{stem}_original.md` â†’ è¦†ç›– â†’ `{stem}_review.json` |
| 16 | 18 é¡¹ Checklist | åŸ 15 + field-completeness + designRef-validity + prd-dev-consistency |

### A. ä»£ç æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | çŠ¶æ€ | Phase | ä»»åŠ¡ |
|---------|------|-------|------|
| `skills/BotoolAgent/PyramidPRD/SKILL.md` | ä¿®æ”¹ | Phase 1, 4, 5 | DT-001~004, DT-018~026 |
| `skills/BotoolAgent/PRD2JSON/SKILL.md` | ä¿®æ”¹ | Phase 2, 3 | DT-005~010, DT-017 |
| `skills/BotoolAgent/PRDReview/SKILL.md` | ä¿®æ”¹ | Phase 3 | DT-016 |
| `skills/BotoolAgent/Testing/SKILL.md` | ä¿®æ”¹ | Phase 3 | DT-012 |
| `skills/BotoolAgent/Coding/SKILL.md` | ä¿®æ”¹ | Phase 3 | DT-013 |
| `skills/BotoolAgent/Finalize/SKILL.md` | ä¿®æ”¹ | Phase 3 | DT-014 |
| `CLAUDE.lead.md` | ä¿®æ”¹ | Phase 3 | DT-011 |
| `scripts/BotoolAgent.sh` | ä¿®æ”¹ | Phase 3 | DT-015 |

### B. é£é™©ä¸ç¼“è§£æªæ–½

#### HIGH
- **Subagent åµŒå¥—è°ƒç”¨ Skill ç¨³å®šæ€§**: spike å·²éªŒè¯å¯è¡Œï¼Œä½†ç”Ÿäº§ç¯å¢ƒå¯èƒ½æœ‰è¾¹ç•Œæƒ…å†µ â†’ **ç¼“è§£**: æ˜ç¡®é™çº§è·¯å¾„ï¼ˆæ‰“å°æ¢å¤æŒ‡ä»¤ï¼‰ï¼Œç¼–æ’å™¨å†…æ·»åŠ  try/catch

#### MEDIUM
- **å¤§æ–‡ä»¶ Phase Bundle åˆå¹¶ä¸€è‡´æ€§**: å¤šä¸ª Subagent å¹¶è¡Œå¤„ç†ä¸åŒ Phaseï¼Œåˆå¹¶æ—¶å¯èƒ½æœ‰äº¤å‰å¼•ç”¨å†²çª â†’ **ç¼“è§£**: Master Context åµŒå…¥æ¯ä¸ª Bundle ç¡®ä¿å…±äº«ä¸Šä¸‹æ–‡ä¸€è‡´
- **pipeline.lock ç«æ€**: ç¼–æ’å™¨å¯åŠ¨å’Œæ‰‹åŠ¨æ‰§è¡Œçš„æ—¶é—´çª—å£ â†’ **ç¼“è§£**: PID æ ¡éªŒ + TTL 30min è‡ªåŠ¨æ¸…é™¤

#### LOW
- **æ–¹æ¡ˆå¡è§£æè¯¯è§£ç‡**: ç”¨æˆ·è¾“å…¥å¤æ‚ä¿®æ”¹æŒ‡ä»¤å¯èƒ½è¯¯è§£æ â†’ **ç¼“è§£**: å¼ºåˆ¶å›æ˜¾ç¡®è®¤æœºåˆ¶ï¼Œè¯¯è§£æå¯è¢«å³æ—¶çº æ­£

### C. æµ‹è¯•ç­–ç•¥

#### è¾“å‡ºæ ¼å¼ + ç®¡çº¿ä¸»æƒ
- [ ] é‡æ–°è½¬æ¢ botool-present-v16 â†’ CREATE TABLE å­—æ®µå®Œæ•´ç‡ â‰¥ 95%
- [ ] é‡æ–°è½¬æ¢ botool-present-v16 â†’ ä¸šåŠ¡è§„åˆ™è¦†ç›–ç‡ â‰¥ 40%
- [ ] Lead Agent æ‰§è¡Œ DT æ—¶ä¸å† skip-read prd.md Â§7
- [ ] prd.md Â§7 ä¿ç•™å®Œæ•´ï¼ˆPRD2JSON ä¸ä¿®æ”¹ï¼‰
- [ ] dev.json æŸååï¼Œé‡è·‘ /prd2json å¯ä» prd.md Â§7 æ¢å¤
- [ ] Ralph è‡ªåŠ¨ç®¡çº¿ç«¯åˆ°ç«¯é€šè¿‡
- [ ] PRD2JSON å¯¹ prd.md é›¶å†™å…¥
- [ ] PRD2JSON é›¶ç”¨æˆ·äº¤äº’
- [ ] PRDReview auto-chain Circuit Breaker é»˜è®¤ accept + advisory
- [ ] PRDReview Standalone: å¤‡ä»½ `test_original.md` â†’ è¦†ç›– `test.md` â†’ äº§å‡º `test_review.json`
- [ ] A2 Checklist 18 é¡¹å…¨é€šè¿‡
- [ ] R1 è§„èŒƒç¡®è®¤ç»“æœæ­£ç¡®å†™å…¥ journal å¹¶è¢« PRD2JSON è¯»å–
- [ ] pipeline.lock æ­£ç¡®åˆ›å»º/æ¸…ç†/stale å¤„ç†

#### ä¸‰æ¨¡å¼ç»Ÿä¸€
- [ ] Transform æ¨¡å¼æ‰§è¡Œ S1 ä»£ç æ‰«æ
- [ ] Transform æ¨¡å¼æ‰§è¡Œ R1 è§„èŒƒç¡®è®¤
- [ ] Transform æ¨¡å¼æ‰§è¡Œ Phase 5.5 å¤–éƒ¨ä¾èµ–æ‰«æ
- [ ] ä¸‰æ¨¡å¼å…±äº«é˜¶æ®µ: P0â†’S1â†’R1â†’[æ¨¡å¼ç‰¹å®š]â†’Phase 5.5â†’L5â†’G1/W1â†’Tfâ†’[Ralph: A1â†’A2]

#### æ‰§è¡Œå¼•æ“
- [ ] å®Œæ•´è§„åˆ’ä¸»å¯¹è¯ä¸Šä¸‹æ–‡ â‰¤ 50KB
- [ ] Transform å¤„ç† 8120 è¡Œ PRD ä¸è§¦å‘ context limit
- [ ] /compact å Read journal æ¢å¤é—®ç­”

#### é—®ç­”åŠ é€Ÿ
- [ ] å®Œæ•´è§„åˆ’äº¤äº’ â‰¤ 10 æ¬¡
- [ ] æ¯ä¸ªæ–¹æ¡ˆå¡æ¯ä¸ª Q æœ‰ AI æ¨èæ ‡è®°
- [ ] "Q3 æ¢ B" æ­£ç¡®è§£æ

### D. éç›®æ ‡ (Out of Scope)

- **ä¸å‰¥ç¦» Â§7** â€” fat dev.json å·²è§£å†³è·³è¯»é—®é¢˜ï¼ŒÂ§7 ä¿ç•™ä¸ºå®‰å…¨ç½‘
- **ä¸ç”Ÿæˆ dev.md** â€” é›¶ç‹¬ç«‹æ¶ˆè´¹æ–¹
- **ä¸ä¿®æ”¹ prd.md æ ¼å¼** â€” PyramidPRD Phase 7 è¾“å‡ºå®Œå…¨ä¸å˜
- **Viewer é€‚é…** â€” 18 ä¸ªæ–‡ä»¶ç•™ CLI å±‚å®Œæˆåå•ç‹¬ PRD
- **ä¸æ‹†åˆ† prd.md ä¸ºå¤šæ–‡ä»¶** â€” å•æ–‡ä»¶ä¿æŒç®€å•
- **ä¸ä¿®æ”¹æ—§ prd.json** â€” archive åä¸å›å¤´
- **ä¸ä¿®æ”¹ L0 æ–¹å‘æ¢ç´¢** â€” markdown é¢„è§ˆä¿æŒä¸å˜
- **ä¸ä¿®æ”¹ L5 ç¡®è®¤é—¨æ§ ASCII æ ¼å¼**
- **ä¸ä¿®æ”¹ pack.sh**
- **ä¸ä¿®æ”¹ PRDReview å†…éƒ¨å®¡æŸ¥é€»è¾‘** â€” Codex æ•Œå¯¹å¾ªç¯/é™çº§æ¨¡å¼/Circuit Breaker ä¿æŒä¸å˜
- **ä¸åˆ é™¤ PRDReview è¦†ç›–èƒ½åŠ›** â€” review-save ä¿ç•™

### E. å®‰å…¨æ£€æŸ¥é¡¹

| DT | å®‰å…¨æ£€æŸ¥ | æ¥æº |
|----|---------|------|
| DT-005 | eval å‘½ä»¤é™åˆ¶ä¸ºå·²çŸ¥å®‰å…¨æ¨¡æ¿ï¼ˆ`npx tsc --noEmit` ç­‰ï¼‰| BR-038 |
| DT-005 | æ‹’ç»ç®¡é“ç¬¦(`\|`)ã€é“¾å¼æ‰§è¡Œ(`&&`/`\|\|`/`;`)ã€é‡å®šå‘(`>`) | BR-038 |
| DT-003 | SOURCE_PRD.ref è·¯å¾„ç» realpath å½’ä¸€åŒ– | BR-039 |
| DT-003 | æ‹’ç»å« `..` æˆ–ç¬¦å·é“¾æ¥é€ƒé€¸çš„è·¯å¾„ | BR-039 |
| DT-016 | Codex `exec --full-auto` æ²™ç®±é™é¡¹ç›®ç›®å½• + /tmp | BR-040 |
| DT-016 | auto-chain è¦†ç›–ä»…é™ `tasks/<id>/prd.md` | BR-040 |
| DT-008 | Checklist é¡¹ 8 å¼ºåˆ¶éªŒè¯ eval å‘½ä»¤å®‰å…¨ | BR-038 |

### F. äº§ç‰©æ¸…å•

**æ°¸ä¹…äº§ç‰©**:

| æ–‡ä»¶ | å†™å…¥æ–¹ | æ¶ˆè´¹æ–¹ |
|------|-------|-------|
| `tasks/<id>/prd.md` | PyramidPRD(ä¸»), PRDReview(å—æ§) | PRD2JSON, Lead, äººç±» |
| `tasks/<id>/dev.json` | PRD2JSON | Lead, Testing, Coding, Finalize, BotoolAgent.sh |
| `./dev.json` | PRD2JSON | BotoolAgent.sh, Leadï¼ˆæ ¹ç›®å½•å…¼å®¹å‰¯æœ¬ï¼‰ |
| `tasks/registry.json` | PRD2JSON, Finalize | Coding, BotoolAgent.sh, Viewer |
| `tasks/<id>/prd-review.json` | PRDReview | äººç±», Viewer UI |
| `tasks/<id>/prd-review-fixed.md` | PRDReview | äººç±» |
| `tasks/<id>/prd-completeness-report.md` | PyramidPRD(Tf) | äººç±» |
| `PROJECT.md` | PyramidPRD | äººç±» |

**ä¸­é—´äº§ç‰©**:

| æ–‡ä»¶ | ç”Ÿäº§æ–¹ | æ¶ˆè´¹æ–¹ |
|------|-------|-------|
| `tasks/<id>/qa-journal.md` | PyramidPRD | å„å±‚ + Subagent + PRD2JSON |
| `tasks/<id>/codebase-scan.md` | Explore Subagent | PRD Subagent + L5 |
| `tasks/<id>/source-analysis.md` | Explore Subagent | Transform L5 + Subagent |
| `tasks/<id>/prd_original.md` | PyramidPRD Ti | Tf å­—æ®µæ ¡éªŒ |
| `tasks/<id>/SOURCE_PRD.ref` | PyramidPRD Ti | Tf å®Œæ•´æ€§æ¯”å¯¹ |

**å·²åºŸå¼ƒ/ä¸äº§ç”Ÿ**:

| æ–‡ä»¶/å­—æ®µ | åŸå›  |
|----------|------|
| `prd.json` | è¢« `dev.json` å–ä»£ |
| `dev.md` | ADR-2: é›¶æ¶ˆè´¹æ–¹ |
| `constitutionFusedAt` | write-only åƒµå°¸å­—æ®µ |
| `knownGaps[]` | æ”¹å†™å…¥ report.md |

### G. æ¶ˆè´¹æ–¹å½±å“åˆ†æ

| æ¶ˆè´¹æ–¹ | å½“å‰è¯»å– | æ–°è¯»å– | æ”¹åŠ¨è¦ç‚¹ |
|--------|---------|--------|---------|
| CLAUDE.lead.md | prd.json (slim+fat) | dev.json (fat-only) | åˆ  slim + prdSectionï¼›æ–°å¢ designRefs |
| Testing SKILL | prd.json | dev.json | è·¯å¾„æ›¿æ¢ |
| Coding SKILL | prd.json | dev.json | è·¯å¾„æ›¿æ¢ |
| Finalize SKILL | prd.json | dev.json | è·¯å¾„æ›¿æ¢ |
| BotoolAgent.sh | prd.json (6 å¤„) | dev.json | å…¨å±€æ›¿æ¢ |
| PRDReview | prd.md + å¯è¦†ç›– | prd.md (A1 è‡ªåŠ¨è¦†ç›–) + Standalone | åŒæ¨¡å¼ |

Viewer å±‚ï¼ˆ18 ä¸ªæ–‡ä»¶ï¼‰ç•™ CLI å±‚å®Œæˆåå•ç‹¬ PRDã€‚

### H. åŠŸèƒ½ä¿ç•™æ¸…å•ï¼ˆå®¡è®¡å®‰å…¨ç½‘ï¼‰

**PyramidPRD ä¿ç•™ä¸å˜**:

| åŠŸèƒ½ | ç¡®è®¤ |
|------|------|
| Phase 0 æ¨¡å¼é€‰æ‹©ï¼ˆ3 æ¨¡å¼ï¼‰ | âœ… 4â†’3 æ¨¡å¼ |
| L0 markdown æ¶æ„é¢„è§ˆ | âœ… ä¸å˜ |
| L0 èŒƒå›´ç¡®è®¤ï¼ˆYAGNIï¼‰ | âœ… ä¸å˜ |
| L1-L4 é—®é¢˜å†…å®¹å’Œç»´åº¦æ¿€æ´»é€»è¾‘ | âœ… äº¤äº’æ–¹å¼æ”¹ä¸ºæ–¹æ¡ˆå¡ |
| Phase 2.5 ä»£ç åº“ 8 æ­¥æ‰«æ | âœ… æ”¹ä¸º Subagent æ‰§è¡Œ |
| PROJECT.md ç”Ÿæˆ | âœ… ä¸å˜ |
| Phase 5.5 å¤–éƒ¨ä¾èµ–æ‰«æ | âœ… ä¸å˜ |
| L5 ç¡®è®¤é—¨æ§ï¼ˆ2 è½® 4Tab ASCIIï¼‰ | âœ… ä¸å˜ |
| Phase 7 PRD ç”Ÿæˆæ¨¡æ¿ï¼ˆÂ§1-Â§8ï¼‰ | âœ… æ”¹ä¸º Subagent æ‰§è¡Œ |
| Phase 7.5 å®‰å…¨æ£€æŸ¥è‡ªåŠ¨æ³¨å…¥ | âœ… ä¸å˜ |
| Transform å®Œæ•´æµç¨‹ | âœ… Tf å¢å¼º + æ–°å¢ S1+R1+Phase5.5 |
| ~~å¿«é€Ÿä¿®å¤æ¨¡å¼~~ | â›” **å·²åˆ é™¤** |

**PRD2JSON ä¿ç•™ä¸å˜**:

| åŠŸèƒ½ | ç¡®è®¤ |
|------|------|
| Viewer æ¨¡å¼æ£€æµ‹ + dev server å¯åŠ¨ | âœ… æ–‡å­—æ›´æ–° |
| CLI/Viewer åŒæ¨¡å¼ | âœ… ä¸å˜ |
| è§„åˆ™æ‰«æï¼ˆrules/ é€’å½’ï¼‰ | âœ… ä¸å˜ |
| constitution file+checklist | âœ… ä¸å˜ |
| testCases å…ˆè¯» PRD å†ç”Ÿæˆ | âœ… é€šè¿‡ designRefs æ›¿ä»£ prdSection |
| playwrightMcp 8 ç§ action | âœ… ä¸å˜ |
| ä¼šè¯åˆ†ç»„ï¼ˆmax 8 DTï¼‰ | âœ… ä¸å˜ |
| æ—§æ–‡ä»¶å½’æ¡£ï¼ˆarchive/ï¼‰ | âœ… ä¸å˜ |
| ~~è§„åˆ™é€‰æ‹©ç¡®è®¤~~ | â›” ç§»è‡³ PyramidPRD R1 |
| ~~å®Œæ•´æ€§æ¯”å¯¹~~ | â›” ç§»è‡³ PyramidPRD Tf |

**PRDReview ä¿ç•™ä¸å˜**:

| åŠŸèƒ½ | ç¡®è®¤ |
|------|------|
| Codex `exec --full-auto` æ•Œå¯¹å®¡æŸ¥ | âœ… ä¸å˜ |
| 3 è½®æ•Œå¯¹å¾ªç¯ï¼ˆä¿®å¤ + é©³å›ï¼‰ | âœ… ä¸å˜ |
| Circuit Breaker | âœ… ä¸å˜ |
| Codex ä¸å¯ç”¨é™çº§ | âœ… ä¸å˜ |
| fail-closed åŸåˆ™ | âœ… ä¸å˜ |
| PRD å®¡æŸ¥ 5 ç»´åº¦ | âœ… ä¸å˜ |
| review-save è¦†ç›– prd.md | âœ… A1 ä¿ç•™ |
| ğŸ†• Standalone ä»»æ„ .md å®¡æŸ¥ | ğŸ†• æ–°å¢ |
| ~~ç‹¬ç«‹é¡¹ç›®å®¡æŸ¥~~ | â›” å·²åˆ é™¤ |
| ~~Enrich å®¡æŸ¥~~ | â›” ç§»è‡³ A2 Checklist #18 |

### I. å·²å†³ç­–çš„å¼€æ”¾é—®é¢˜

| # | é—®é¢˜ | å†³ç­– |
|---|------|------|
| 1a | auto-chain æœºåˆ¶ | PRDing Ralphï¼ˆBackground Agent ç¼–æ’å™¨ï¼‰ |
| 1b | Subagent åœ¨ Skill ä¸­çš„è°ƒç”¨ | å®‰å…¨å¯ç”¨ï¼ˆspike éªŒè¯ï¼‰ |
| 2 | Q&A Journal æ ¼å¼ | çº¯ Markdownï¼ˆå›ºå®šæ ‡é¢˜é”šç‚¹ï¼‰ |
| 3 | å¤§æ–‡ä»¶å¹¶è¡Œä¸Šé™ | â‰¤ 4 å¹¶è¡Œ |
| 4 | Phase 4-5 æ˜¯å¦æ‹† PRD | ä¸æ‹†ï¼Œ27 DT ä¿æŒä¸€ä¸ª PRD |
| 5 | prd-dev-consistency | ç§»å…¥ A2 Checklist ç¬¬ 18 é¡¹ |
| 6 | auto-chain å¤±è´¥çŠ¶æ€ | Ralph æ¨¡å‹ + æ˜ç¡®æ¢å¤æŒ‡ä»¤ |
| 7 | PRDReview é‡‡çº³æµç¨‹ | A1 è‡ªåŠ¨è¦†ç›–ï¼›ç‹¬ç«‹é¡¹ç›®å®¡æŸ¥å·²åˆ é™¤ |
| 8 | æ–¹æ¡ˆå¡é€‰é¡¹æ•°é‡ | æ¯é¢˜ 2-4 ä¸ª + æ•´å¡çº§ Type something |
| 9 | åŠŸèƒ½å¼€å‘æ–¹æ¡ˆå¡ | YESï¼ŒL1+L4 ä»ç”¨æ–¹æ¡ˆå¡ |
| 10 | PRDReview ä½ç½® | A1: PRD2JSON ä¹‹å‰ |
| 11 | è§„èŒƒç¡®è®¤ä½ç½® | R1: ä» PRD2JSON ç§»è‡³ PyramidPRD |
| 12 | å¿«é€Ÿä¿®å¤æ¨¡å¼ | åˆ é™¤ï¼ˆ4â†’3 æ¨¡å¼ï¼‰ |
| 13 | Transform ç¼º S1/R1 | ç»Ÿä¸€åŠ ä¸Šï¼ˆä¸‰æ¨¡å¼å…±äº«ï¼‰ |
| 14 | å®Œæ•´æ€§æ¯”å¯¹ä½ç½® | ç§»è‡³ PyramidPRD Tf |
| 15 | PRDing Ralph æ‰§è¡Œæ¨¡å‹ | Background Agent ç¼–æ’å™¨ |
