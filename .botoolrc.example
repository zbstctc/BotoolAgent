# BotoolAgent 配置文件
# 复制此文件为 .botoolrc 并根据需要修改配置
# 所有配置项都有默认值，未设置的项将使用默认值
# 配置优先级：环境变量 > .botoolrc > 默认值

# ============================================================================
# 基础配置
# ============================================================================

# 最大迭代次数
# 默认: 10
MAX_ITERATIONS=10

# 每次迭代的超时时间（秒）
# 默认: 1800 (30分钟)
ITERATION_TIMEOUT=1800

# 每次迭代的最大重试次数
# 默认: 3
MAX_RETRIES=3

# 进程健康检查间隔（秒）
# 用于检测 Claude 进程是否卡住
# 默认: 10
HEALTH_CHECK_INTERVAL=10

# 进程卡住判定阈值
# 连续多少次健康检查都是 0% CPU 时判定为卡住
# 默认: 30 (30 * 10秒 = 5分钟)
STALL_THRESHOLD=30

# 网络检查重试间隔（秒）
# 默认: 30
NETWORK_RETRY_INTERVAL=30

# ============================================================================
# Rate Limiting 配置
# ============================================================================

# 是否启用 Rate Limiting
# 限制单位时间内的 API 调用次数
# 默认: true
RATE_LIMIT_ENABLED=true

# 时间窗口内最大调用次数
# 默认: 100
RATE_LIMIT_MAX_CALLS=100

# 时间窗口（秒）
# 默认: 3600 (1小时)
RATE_LIMIT_WINDOW=3600

# ============================================================================
# Circuit Breaker 配置
# ============================================================================

# 是否启用 Circuit Breaker
# 连续多次迭代无进展时自动停止
# 默认: true
CIRCUIT_BREAKER_ENABLED=true

# 无进展迭代次数阈值
# 连续多少次迭代没有完成新任务时触发停止
# 默认: 3
CIRCUIT_BREAKER_THRESHOLD=3

# ============================================================================
# 网络健康检查配置
# ============================================================================

# 是否启用运行时网络健康检查
# 检测 Claude 进程是否有网络活动
# 默认: true
NETWORK_HEALTH_CHECK_ENABLED=true

# 网络健康检查间隔（秒）
# 默认: 60
NETWORK_HEALTH_CHECK_INTERVAL=60

# 无网络活动阈值（秒）
# 超过此时间无网络活动将重启进程
# 默认: 300 (5分钟)
NETWORK_NO_ACTIVITY_THRESHOLD=300

# ============================================================================
# Hooks 配置（可选）
# ============================================================================
# Hooks 允许你在关键节点执行自定义脚本
# 脚本路径可以是绝对路径或相对于 BotoolAgent.sh 所在目录的相对路径
# Hook 执行失败不会影响主流程
# 每个 Hook 最多执行 60 秒，超时将被终止

# 每次迭代开始前执行的脚本
# 用途：准备工作、清理缓存、发送开始通知等
# 环境变量：BOTOOL_HOOK_TYPE, BOTOOL_ITERATION, BOTOOL_MAX_ITERATIONS,
#           BOTOOL_PRD_FILE, BOTOOL_PROGRESS_FILE, BOTOOL_LOG_DIR,
#           BOTOOL_COMPLETED_TASKS, BOTOOL_TOTAL_TASKS
# 参数：$1 = 当前迭代次数
# HOOK_PRE_ITERATION="./hooks/pre-iteration.sh"

# 每次迭代完成后执行的脚本
# 用途：记录日志、发送进度通知、清理临时文件等
# 环境变量：同上
# 参数：$1 = 当前迭代次数, $2 = 是否成功 (true/false)
# HOOK_POST_ITERATION="./hooks/post-iteration.sh"

# 所有任务完成时执行的脚本
# 用途：发送完成通知、生成报告、触发 CI/CD 等
# 环境变量：同上
# HOOK_ON_COMPLETE="./hooks/on-complete.sh"

# 发生错误时执行的脚本
# 用途：发送错误通知、记录错误日志、触发告警等
# 环境变量：同上
# 参数：$1 = 错误类型 (iteration_failed/circuit_breaker/max_iterations)
#       $2 = 错误消息
# HOOK_ON_ERROR="./hooks/on-error.sh"

# ============================================================================
# 通知配置（可选）
# ============================================================================
# 在任务完成或发生错误时发送 macOS 系统通知
# 目前仅支持 macOS 系统

# 是否启用系统通知
# 启用后会在以下情况发送通知：
#   - 所有任务完成时（成功通知）
#   - 迭代失败时（错误通知）
#   - Circuit Breaker 触发时（错误通知）
#   - 达到最大迭代次数时（错误通知）
# 默认: false
NOTIFICATION_ENABLED=false

# 通知时是否播放声音
# 不同类型的通知会播放不同的声音：
#   - 成功: Glass
#   - 错误: Basso
#   - 警告: Sosumi
#   - 信息: Pop
# 默认: true
NOTIFICATION_SOUND=true

# ============================================================================
# 环境变量覆盖
# ============================================================================
# 所有配置项都可以通过环境变量覆盖，格式为 BOTOOL_<配置名>
# 例如：
#   BOTOOL_MAX_ITERATIONS=20
#   BOTOOL_TIMEOUT=3600
#   BOTOOL_RETRIES=5
#   BOTOOL_RATE_LIMIT_ENABLED=false
#   BOTOOL_RATE_LIMIT_MAX_CALLS=50
#   BOTOOL_RATE_LIMIT_WINDOW=7200
#   BOTOOL_CIRCUIT_BREAKER_ENABLED=false
#   BOTOOL_CIRCUIT_BREAKER_THRESHOLD=5
#   BOTOOL_NETWORK_HEALTH_CHECK_ENABLED=false
#   BOTOOL_NETWORK_HEALTH_CHECK_INTERVAL=120
#   BOTOOL_NETWORK_NO_ACTIVITY_THRESHOLD=600
#   BOTOOL_HOOK_PRE_ITERATION="./my-hooks/pre.sh"
#   BOTOOL_HOOK_POST_ITERATION="./my-hooks/post.sh"
#   BOTOOL_HOOK_ON_COMPLETE="./my-hooks/complete.sh"
#   BOTOOL_HOOK_ON_ERROR="./my-hooks/error.sh"
#   BOTOOL_NOTIFICATION_ENABLED=true
#   BOTOOL_NOTIFICATION_SOUND=false

# ============================================================================
# Hook 示例脚本
# ============================================================================
# 下面是一些常见的 Hook 使用场景示例:
#
# pre-iteration.sh - 发送 Slack 通知
# #!/bin/bash
# curl -X POST -H 'Content-type: application/json' \
#   --data "{\"text\":\"BotoolAgent 开始第 $1 次迭代\"}" \
#   $SLACK_WEBHOOK_URL
#
# post-iteration.sh - 记录日志
# #!/bin/bash
# echo "[$(date)] Iteration $1 completed (success=$2)" >> /var/log/botool.log
#
# on-complete.sh - macOS 系统通知
# #!/bin/bash
# osascript -e 'display notification "所有任务已完成！" with title "BotoolAgent"'
#
# on-error.sh - 发送邮件告警
# #!/bin/bash
# echo "错误类型: $1\n错误消息: $2" | mail -s "BotoolAgent 错误" admin@example.com
